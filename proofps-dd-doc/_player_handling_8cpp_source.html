<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PRooFPS-dd Dev Doc: C:/__PR00F__/___developing___/projects/PRooFPS-dd/PRooFPS-dd/PlayerHandling.cpp Source File</title>
<link rel="icon" href="PRooFPS-dd.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="PRooFPS-dd_DoxyStyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PRooFPS-dd-logo-200x55.png"/></td>
  <td id="projectalign">
   <div id="projectname">PRooFPS-dd Dev Doc<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">PRooFPS-dd Developer Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_player_handling_8cpp_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">PlayerHandling.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="_player_handling_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">    ###################################################################################</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">    PlayerHandling.cpp</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">    PlayerHandling class for PRooFPS-dd</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">    Made by PR00F88, West Whiskhyll Entertainment</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">    2023</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">    ###################################################################################</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">*/</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="stdafx_8h.html">stdafx.h</a>&quot;</span>  <span class="comment">// PCH</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="_player_handling_8h.html">PlayerHandling.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="_physics_8h.html">Physics.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="_p_roo_f_p_s-dd-packet_8h.html">PRooFPS-dd-packet.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">// ############################### PUBLIC ################################</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="foldopen" id="foldopen00020" data-start="{" data-end="}">
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a63d1eb5d7ffb36b810891b101232fe30">   20</a></span><span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a63d1eb5d7ffb36b810891b101232fe30">proofps_dd::PlayerHandling::getLoggerModuleName</a>()</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>{</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;PlayerHandling&quot;</span>;</div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>}</div>
</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="foldopen" id="foldopen00025" data-start="{" data-end="}">
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a61078cefb43a1a8b5483ec7427bb98f4">   25</a></span><a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a61078cefb43a1a8b5483ec7427bb98f4">proofps_dd::PlayerHandling::PlayerHandling</a>(</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    PGE&amp; pge,</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    <a class="code hl_struct" href="structproofps__dd_1_1_durations.html">proofps_dd::Durations</a>&amp; durations,</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>    <a class="code hl_class" href="classproofps__dd_1_1_g_u_i.html">proofps_dd::GUI</a>&amp; gui,</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    std::map&lt;pge_network::PgeNetworkConnectionHandle, proofps_dd::Player&gt;&amp; mapPlayers,</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    <a class="code hl_class" href="classproofps__dd_1_1_maps.html">proofps_dd::Maps</a>&amp; maps,</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <a class="code hl_class" href="classproofps__dd_1_1_sounds.html">proofps_dd::Sounds</a>&amp; sounds) :</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <a class="code hl_namespace" href="namespaceproofps__dd.html">proofps_dd</a>::<a class="code hl_class" href="classproofps__dd_1_1_networking.html">Networking</a>(pge, durations),</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    m_pge(pge),</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    m_gui(gui),</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    m_mapPlayers(mapPlayers),</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    m_maps(maps),</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    m_sounds(sounds)</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>{</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="comment">// note that the following should not be touched here as they are not fully constructed when we are here:</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="comment">// pge, durations, gui, maps, sounds</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment">// But they can used in other functions.</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    <span class="comment">// Since this class is used to build up the PRooFPSddPGE class which is derived from PGE class, PGE is not yet initialized</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// when this ctor is invoked. PRooFPSddPGE initializes PGE later. Furthermore, even the pimpl object inside PGE might not</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// be existing at this point, only isGameRunning() is safe to call. The following assertion is reminding me of that:</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    assert(!pge.isGameRunning());</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>}</div>
</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="foldopen" id="foldopen00049" data-start="{" data-end="}">
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a3e8a5e2a0d3b79ae2019a91ff1653bae">   49</a></span>CConsole&amp; <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a3e8a5e2a0d3b79ae2019a91ff1653bae">proofps_dd::PlayerHandling::getConsole</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keywordflow">return</span> CConsole::getConsoleInstance(getLoggerModuleName());</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>}</div>
</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">// ############################## PROTECTED ##############################</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="foldopen" id="foldopen00058" data-start="{" data-end="}">
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a1b78d5fbd2b936ebb07972c2aa1ec4b2">   58</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a1b78d5fbd2b936ebb07972c2aa1ec4b2">proofps_dd::PlayerHandling::handlePlayerDied</a>(</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <a class="code hl_class" href="classproofps__dd_1_1_player.html">Player</a>&amp; player,</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <a class="code hl_class" href="classproofps__dd_1_1_x_hair.html">XHair</a>&amp; xhair,</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="keyword">const</span> pge_network::PgeNetworkConnectionHandle&amp; nKillerConnHandleServerSide,</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; <span class="comment">/*gameMode*/</span>)</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>{</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="comment">// here design is good because server and client share the same code</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#af13afd5bf5ec85d9789f910ca8918db7">die</a>(isMyConnection(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>()), m_pge.getNetwork().isServer());</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment">// TODO: other player-related sounds are played by Player instance, e.g. Player::handleLanded(), this should be consolidated in the future</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    m_pge.getAudio().play3dSound(m_sounds.m_sndPlayerDie, player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#ab6a8df62f5a73d6ce1c498284bb7c346">getPos</a>().getNew());</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s() playing die sound&quot;, __func__);</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="keywordflow">if</span> (isMyConnection(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>()))</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        xhair.<a class="code hl_function" href="classproofps__dd_1_1_x_hair.html#a673471bd6f4e414db099b7666ec0f859">hide</a>();</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    }</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// design was good until this line, in the future we should change MsgDeathNotificationFromServer to be injected also to server, thus</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// the same message handling would do everything for both server and client</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="comment">// !!! BADDESIGN !!!</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="keywordflow">if</span> (m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    {</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="comment">// important: killer info is just for informational purpose so we can display it, however</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        <span class="comment">// if the killer got disconnected already, conn handle is set as same as player&#39;s connhandle, so we can still</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="comment">// show the player dieing without a killer, however it is not suicide in such case, that is why we should never</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="comment">// decrease frags based only on this value!</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        <span class="comment">// server displays death notification on gui here, client displays in handleDeathNotificationFromServer() as we send the pkt out below</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        assert(m_gui.getDeathKillEvents());</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        std::string sKillerName;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_player.html">Player</a>* pPlayerKiller = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="keywordflow">if</span> (nKillerConnHandleServerSide != player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>())</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>        {</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            <span class="keyword">const</span> <span class="keyword">auto</span> itPlayerKiller = m_mapPlayers.find(nKillerConnHandleServerSide);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            <span class="keywordflow">if</span> (m_mapPlayers.end() != itPlayerKiller)</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            {</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                sKillerName = itPlayerKiller-&gt;second.getName();</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                pPlayerKiller = &amp;(itPlayerKiller-&gt;second);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>            }</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        m_gui.getDeathKillEvents()-&gt;addDeathKillEvent(sKillerName, player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a451ec29e2b00f6bc2fd0792619c0214a">getName</a>());</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        pge_network::PgePacket pktDeathNotificationFromServer;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        <a class="code hl_function" href="structproofps__dd_1_1_msg_death_notification_from_server.html#aaafe595af6300812a7450634e23e9e11">proofps_dd::MsgDeathNotificationFromServer::initPkt</a>(</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>            pktDeathNotificationFromServer,</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>            player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>(),</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            nKillerConnHandleServerSide);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>        m_pge.getNetwork().getServer().sendToAllClientsExcept(pktDeathNotificationFromServer);</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        <span class="comment">// from v0.2.5, server shows respawn timer here for themselves, client shows upon receiving MsgDeathNotificationFromServer</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        <span class="keywordflow">if</span> (isMyConnection(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>()))</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        {</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            m_gui.showRespawnTimer(pPlayerKiller);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        }</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    }</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>}</div>
</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="foldopen" id="foldopen00116" data-start="{" data-end="}">
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#abf980bb9e4f7d43b143cb914a4147bbb">  116</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#abf980bb9e4f7d43b143cb914a4147bbb">proofps_dd::PlayerHandling::handlePlayerRespawned</a>(</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <a class="code hl_class" href="classproofps__dd_1_1_player.html">Player</a>&amp; player,</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <a class="code hl_class" href="classproofps__dd_1_1_x_hair.html">XHair</a>&amp; xhair)</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>{</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// Remember this function is NOT invoked when just connected to a new game!</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// For setting initial stuff after connect, use handleUserUpdateFromServer(), where it checks for isJustCreatedAndExpectingStartPos()!</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="keyword">const</span> Weapon* <span class="keyword">const</span> wpnDefaultAvailable = player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#abc1fc328295a2274fadc644e124789f6">getWeaponManager</a>().getWeaponByFilename(</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#abc1fc328295a2274fadc644e124789f6">getWeaponManager</a>().getDefaultAvailableWeaponFilename());</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    assert(wpnDefaultAvailable);  <span class="comment">// cannot be null since it is already verified in handleUserSetupFromServer()</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#acf1afe34c4363f54da41b4bbb4f16c43">respawn</a>(isMyConnection(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>()), *wpnDefaultAvailable, m_pge.getNetwork().isServer());</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span> </div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="keywordflow">if</span> (isMyConnection(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">getServerSideConnectionHandle</a>()))</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    {</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="comment">// camera must be repositioned immediately so players can see themselves ASAP</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="keyword">auto</span>&amp; camera = m_pge.getPure().getCamera();</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        camera.getPosVec().SetX(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a1fa08e979998dc9b5b6de7da55826f74">getObject3D</a>()-&gt;getPosVec().getX());</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        camera.getPosVec().SetY(player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a1fa08e979998dc9b5b6de7da55826f74">getObject3D</a>()-&gt;getPosVec().getY());</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        camera.getTargetVec().SetX(camera.getPosVec().getX());</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        camera.getTargetVec().SetY(camera.getPosVec().getY());</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        xhair.<a class="code hl_function" href="classproofps__dd_1_1_x_hair.html#af4ab1b3dfb7a35376639f40f498612f4">show</a>();</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        xhair.<a class="code hl_function" href="classproofps__dd_1_1_x_hair.html#a44c8df5eaddd905ea95f95ff6981e3b0">handleMagLoaded</a>();</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        m_gui.hideRespawnTimer();</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        m_gui.hideGameObjectives(); <span class="comment">// just in case player was checking it during respawn countdown, OR game just restarted</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        m_gui.getMinimap()-&gt;show(); <span class="comment">// even though we dont hide it when player dies, game restart eventually respawns players so we need to show because game end hides it</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    }</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>}</div>
</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="foldopen" id="foldopen00145" data-start="{" data-end="}">
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#aebc1556fba9dbe6179e6be50f97ac414">  145</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#aebc1556fba9dbe6179e6be50f97ac414">proofps_dd::PlayerHandling::serverRespawnPlayer</a>(<a class="code hl_class" href="classproofps__dd_1_1_player.html">Player</a>&amp; player, <span class="keywordtype">bool</span> restartGame, <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config)</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>{</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="comment">// to respawn, we just need to set these values, because SendUserUpdates() will automatically send out changes to everyone</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#ab6a8df62f5a73d6ce1c498284bb7c346">getPos</a>() = m_maps.getRandomSpawnpoint();</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#afdfe1ededeb7da766a8d373213a9ebb1">setHealth</a>(100);</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a9eeeb3bf1e5ea9aab700da3b2f68a663">getRespawnFlag</a>() = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#af8590e9659351943648a8e5ea8fe0248">setInvulnerability</a>(<span class="keyword">true</span>, config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">getPlayerRespawnInvulnerabilityDelaySeconds</a>());</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="keywordflow">if</span> (restartGame)</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#ac83a27d89879734a114ddf4d365bb759">getFrags</a>() = 0;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        player.<a class="code hl_function" href="classproofps__dd_1_1_player.html#a71d6c50e93d0fb54c4a95b184211daf2">getDeaths</a>() = 0;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>}</div>
</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="foldopen" id="foldopen00159" data-start="{" data-end="}">
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a117b8fc72f93fcdad2b1b0aa94cc72e1">  159</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a117b8fc72f93fcdad2b1b0aa94cc72e1">proofps_dd::PlayerHandling::serverUpdateRespawnTimers</a>(</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config,</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode,</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <a class="code hl_struct" href="structproofps__dd_1_1_durations.html">proofps_dd::Durations</a>&amp; durations)</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>{</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keywordflow">if</span> (gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a72d2bde6d117d2c0b9ce3e5b4f3d8f73">isGameWon</a>())</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="keyword">const</span> std::chrono::time_point&lt;std::chrono::steady_clock&gt; timeStart = std::chrono::steady_clock::now();</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; playerPair : m_mapPlayers)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    {</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <span class="keyword">auto</span>&amp; player = playerPair.second;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; playerConst = player;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <span class="keywordflow">if</span> (playerConst.getHealth() &gt; 0)</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        }</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> timeDiffSeconds = std::chrono::duration_cast&lt;std::chrono::seconds&gt;(</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            std::chrono::steady_clock::now() - playerConst.getTimeDied()).count();</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(timeDiffSeconds) &gt;= config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a9fc361308ba044aa97f5b5da5235ea89">getPlayerRespawnDelaySeconds</a>())</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            serverRespawnPlayer(player, <span class="keyword">false</span>, config);</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    durations.<a class="code hl_variable" href="structproofps__dd_1_1_durations.html#a7e449a33670af51a3ead75182cc865f7">m_nUpdateRespawnTimersDurationUSecs</a> += std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(std::chrono::steady_clock::now() - timeStart).count();</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>} <span class="comment">// serverUpdateRespawnTimers()</span></div>
</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="foldopen" id="foldopen00192" data-start="{" data-end="}">
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a559106dd5cfb384c608877135610648e">  192</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a559106dd5cfb384c608877135610648e">proofps_dd::PlayerHandling::updatePlayersOldValues</a>()</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>{</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; playerPair : m_mapPlayers)</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="keyword">auto</span>&amp; player = playerPair.second;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="comment">// From v0.1.5 clients invoke updateOldValues() in handleUserUpdateFromServer() thus they are also good to use old vs new values and isDirty().</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="comment">// Server invokes it here in every physics iteration. 2 reasons:</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="comment">// - consecutive physics iterations require old and new values to be properly set;</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="comment">// - player.isNetDirty() thus serverSendUserUpdates() rely on player.updateOldValues().</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        player.updateOldValues();</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>}</div>
</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="foldopen" id="foldopen00205" data-start="{" data-end="}">
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#ab149831d1b98ec8c556b741e6af79d95">  205</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#ab149831d1b98ec8c556b741e6af79d95">proofps_dd::PlayerHandling::writePlayerList</a>()</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>{</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    getConsole().OLnOI(<span class="stringliteral">&quot;PlayerHandling::%s()&quot;</span>, __func__);</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; playerPair : m_mapPlayers)</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    {</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        getConsole().OLn(<span class="stringliteral">&quot;Username: %s; connHandleServerSide: %u; address: %s&quot;</span>,</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>            playerPair.second.getName().c_str(), playerPair.second.getServerSideConnectionHandle(), playerPair.second.getIpAddress().c_str());</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    }</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    getConsole().OO();</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>}</div>
</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="foldopen" id="foldopen00216" data-start="{" data-end="}">
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#aca7062c26e1d154976c33ea8a9a95747">  216</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#aca7062c26e1d154976c33ea8a9a95747">proofps_dd::PlayerHandling::handleUserConnected</a>(</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    pge_network::PgeNetworkConnectionHandle connHandleServerSide,</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keyword">const</span> pge_network::MsgUserConnectedServerSelf&amp; msg,</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    PGEcfgProfiles&amp; cfgProfiles,</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; <span class="comment">/*config*/</span>,</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; <span class="comment">/*gameMode*/</span>,</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    std::function&lt;<span class="keywordtype">void</span>(<span class="keywordtype">int</span>)&gt;&amp; cbDisplayMapLoadingProgressUpdate)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>{</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">if</span> (!m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    {</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): client received, CANNOT HAPPEN!&quot;</span>, __func__);</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    pge_network::PgePacket newPktUserUpdate;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="keywordflow">if</span> (msg.m_bCurrentClient)</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="comment">// server is processing its own birth</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="keywordflow">if</span> (m_mapPlayers.size() == 0)</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        {</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            <span class="comment">// server already loads the map for itself at this point</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>            <span class="keywordflow">if</span> (m_maps.getFilename() != m_maps.getNextMapToBeLoaded())</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            {</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                <span class="comment">// save it just for error log, because upon error even getNextMapToBeLoaded() will be reset</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                <span class="keyword">const</span> std::string sNextMapToBeLoaded = m_maps.getNextMapToBeLoaded();</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                <span class="comment">// if we fall here with non-empty m_maps.getFilename(), it is an error, and m_maps.load() will fail as expected.</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                <span class="keywordflow">if</span> (!m_maps.load(m_maps.getNextMapToBeLoaded().c_str(), cbDisplayMapLoadingProgressUpdate))</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                    getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): m_maps.load() failed: %s!&quot;</span>, __func__, sNextMapToBeLoaded.c_str());</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>                    assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>                }</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            }</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>            {</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>                getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): map %s already loaded&quot;</span>, __func__, m_maps.getNextMapToBeLoaded().c_str());</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>            }</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span> </div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): first (local) user connected and I&#39;m server, so this is me (connHandleServerSide: %u)&quot;</span>,</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                __func__, connHandleServerSide);</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            pge_network::PgePacket newPktSetup;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="structproofps__dd_1_1_msg_user_setup_from_server.html#ad2216b7cd53059ed5be0fafb2e2e1322">proofps_dd::MsgUserSetupFromServer::initPkt</a>(newPktSetup, connHandleServerSide, <span class="keyword">true</span>, msg.m_szIpAddress, m_maps.getNextMapToBeLoaded().c_str()))</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                <span class="keyword">const</span> PureVector&amp; vecStartPos = cfgProfiles.getVars()[<span class="stringliteral">&quot;testing&quot;</span>].getAsBool() ?</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>                    m_maps.getLeftMostSpawnpoint() :</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                    m_maps.getRandomSpawnpoint();</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="structproofps__dd_1_1_msg_user_update_from_server.html#afca442c02e1d376443c47c34bbb3667f">proofps_dd::MsgUserUpdateFromServer::initPkt</a>(</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                    newPktUserUpdate,</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                    connHandleServerSide,</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                    vecStartPos.getX(), vecStartPos.getY(), vecStartPos.getZ(),</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                    0.f <span class="comment">/* player angle Y */</span>, 0.f <span class="comment">/* player angle Z */</span>,</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                    0.f <span class="comment">/* weapon angle Z */</span>,</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                    0.f <span class="comment">/* weapon momentary accuracy */</span>,</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                    <span class="keyword">false</span> <span class="comment">/* bCrouch */</span>, 0.f <span class="comment">/* fSomersaultAngle */</span>,</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                    0 <span class="comment">/* AP */</span>, 100 <span class="comment">/* HP */</span>,</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                    <span class="keyword">false</span> <span class="comment">/* bRespawn */</span>,</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                    0 <span class="comment">/* nFrags */</span>, 0 <span class="comment">/* nDeaths */</span>,</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                    <span class="keyword">false</span> <span class="comment">/* bInvulnerability */</span>))</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                {</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                    <span class="comment">// server injects this msg to self so resources for player will be allocated upon processing these</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                    m_pge.getNetwork().getServer().send(newPktSetup);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                    m_pge.getNetwork().getServer().send(newPktUserUpdate);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>                    getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>                    assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                }</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>            }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            {</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>                getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>                assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>            }</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        }</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        {</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>            <span class="comment">// cannot happen</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): user (connHandleServerSide: %u) connected with bCurrentClient as true but it is not me, CANNOT HAPPEN!&quot;</span>,</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>                __func__, connHandleServerSide);</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        }</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        <span class="keywordflow">if</span> (connHandleServerSide == pge_network::ServerConnHandle)</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): server user (connHandleServerSide: %u) connected but map m_bCurrentClient is false, CANNOT HAPPEN!&quot;</span>,</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                __func__, connHandleServerSide);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        }</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="comment">// server is processing another user&#39;s birth</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): new remote user (connHandleServerSide: %u) connected (from %s) and I&#39;m server&quot;</span>,</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            __func__, connHandleServerSide, msg.m_szIpAddress);</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        pge_network::PgePacket newPktSetup;</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="structproofps__dd_1_1_msg_user_setup_from_server.html#ad2216b7cd53059ed5be0fafb2e2e1322">proofps_dd::MsgUserSetupFromServer::initPkt</a>(newPktSetup, connHandleServerSide, <span class="keyword">false</span>, msg.m_szIpAddress, m_maps.getFilename()))</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>        }</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="keyword">const</span> PureVector&amp; vecStartPos = cfgProfiles.getVars()[<span class="stringliteral">&quot;testing&quot;</span>].getAsBool() ?</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            m_maps.getRightMostSpawnpoint() :</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>            m_maps.getRandomSpawnpoint();</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="structproofps__dd_1_1_msg_user_update_from_server.html#afca442c02e1d376443c47c34bbb3667f">proofps_dd::MsgUserUpdateFromServer::initPkt</a>(</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>            newPktUserUpdate,</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>            connHandleServerSide,</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            vecStartPos.getX(), vecStartPos.getY(), vecStartPos.getZ(),</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            0.f <span class="comment">/* player angle Y */</span>, 0.f <span class="comment">/* player angle Z */</span>,</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>            0.f <span class="comment">/* weapon angle Z */</span>,</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>            0.f <span class="comment">/* weapon momentary accuracy */</span>,</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="keyword">false</span> <span class="comment">/* fSomersaultAngle */</span>, 0.f <span class="comment">/* fSomersaultAngle*/</span>,</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>            0 <span class="comment">/* AP */</span>, 100 <span class="comment">/* HP */</span>,</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            <span class="keyword">false</span> <span class="comment">/* bRespawn */</span>,</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            0 <span class="comment">/* nFrags */</span>, 0 <span class="comment">/* nDeaths */</span>,</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            <span class="keyword">true</span> <span class="comment">/* invulnerable by default */</span>))</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>        {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        }</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        <span class="comment">// server injects this msg to self so resources for player will be allocated upon processing these</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        m_pge.getNetwork().getServer().send(newPktSetup);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        m_pge.getNetwork().getServer().send(newPktUserUpdate);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        <span class="comment">// inform all other clients about this new user</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        m_pge.getNetwork().getServer().sendToAllClientsExcept(newPktSetup, connHandleServerSide);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        m_pge.getNetwork().getServer().sendToAllClientsExcept(newPktUserUpdate, connHandleServerSide);</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        <span class="comment">// now we send this msg to the client with this bool flag set so client will know it is their connect</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <a class="code hl_struct" href="structproofps__dd_1_1_msg_user_setup_from_server.html">proofps_dd::MsgUserSetupFromServer</a>&amp; msgUserSetup = pge_network::PgePacket::getMsgAppDataFromPkt&lt;proofps_dd::MsgUserSetupFromServer&gt;(newPktSetup);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        msgUserSetup.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_setup_from_server.html#a221e17b18c7c2699811ef383a1997a0e">m_bCurrentClient</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        m_pge.getNetwork().getServer().send(newPktSetup, connHandleServerSide);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        m_pge.getNetwork().getServer().send(newPktUserUpdate, connHandleServerSide);</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>}  <span class="comment">// handleUserConnected()</span></div>
</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="foldopen" id="foldopen00367" data-start="{" data-end="}">
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#aadf756677d23335aee5b0db20dec50d6">  367</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#aadf756677d23335aee5b0db20dec50d6">proofps_dd::PlayerHandling::handleUserDisconnected</a>(</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    pge_network::PgeNetworkConnectionHandle connHandleServerSide,</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <span class="keyword">const</span> pge_network::MsgUserDisconnectedFromServer&amp;,</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode)</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>{</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="comment">// Due to https://github.com/proof88/PRooFPS-dd/issues/268, we need to apply WA here.</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="comment">// Explained in details in handlePlayerEventFromServer().</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="comment">// Due to this, now this WA is applied: return true from non-serveronly msg handling functions if connHandle is not found in m_mapPlayers.</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="keyword">const</span> <span class="keyword">auto</span> playerIt = m_mapPlayers.find(connHandleServerSide);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == playerIt)</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    {</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <span class="comment">// ANOTHER CASE ALSO NEEDS WA:</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>        <span class="comment">// TEMPORARILY COMMENTED DUE TO: https://github.com/proof88/PRooFPS-dd/issues/261</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        <span class="comment">// When we are trying to join a server but we get bored and user presses ESCAPE, client&#39;s disconnect is invoked, which</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <span class="comment">// actually starts disconnecting because it thinks we are connected to server, and injects this userDisconnected pkt.</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        <span class="comment">// </span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): failed to find user with connHandleServerSide: %u!&quot;, __func__, connHandleServerSide);</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="comment">//assert(false); // in debug mode, try to understand this scenario</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// in release mode, dont terminate</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="comment">// Server should not remove all players when it it notified with its connHandle being disconnected, because in that case</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// all players are expected to be removed by subsequent calls into this function with their connHandle as their connection state transitions.</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="comment">// There will be userDisconnected message for all players, including the server as well, so eventually this way m_mapPlayers will be</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="comment">// cleared out in multiple steps on server-side.</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="comment">// However, client won&#39;t be notified about all clients disconnecting in this case, but it is quite trivial when the server itself disconnects.</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="comment">// So that is why we manually get rid of all players in case of client.</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="comment">// We need m_mapPlayers to be cleared out by the end of processing all disconnections, the reasion is explained in hasValidConnection().</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bClientShouldRemoveAllPlayers = !m_pge.getNetwork().isServer() &amp;&amp; (connHandleServerSide == pge_network::ServerConnHandle);</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keywordflow">if</span> (m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    {</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        getConsole().OLn(</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            <span class="stringliteral">&quot;PlayerHandling::%s(): user %s with connHandleServerSide %u disconnected and I&#39;m server&quot;</span>,</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>            __func__, playerIt-&gt;second.getName().c_str(), connHandleServerSide);</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    {</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        getConsole().OLn(</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>            <span class="stringliteral">&quot;PlayerHandling::%s(): user %s with connHandleServerSide %u disconnected and I&#39;m client&quot;</span>,</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>            __func__, playerIt-&gt;second.getName().c_str(), connHandleServerSide);</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    }</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#aa627be5e60eeb2cf016a8aaa15025e30">removePlayer</a>(playerIt-&gt;second);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    m_mapPlayers.erase(playerIt);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="keywordflow">if</span> (bClientShouldRemoveAllPlayers)</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    {</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): it was actually the server disconnected so I&#39;m removing every player including myself&quot;</span>, __func__);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        m_gui.hideRespawnTimer();</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        m_gui.hideGameObjectives();</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        assert(m_gui.getDeathKillEvents());</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        assert(m_gui.getItemPickupEvents());</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        assert(m_gui.getPlayerHpChangeEvents());</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        assert(m_gui.getPlayerApChangeEvents());</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        assert(m_gui.getPlayerAmmoChangeEvents());</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        m_gui.getDeathKillEvents()-&gt;clear();</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        m_gui.getItemPickupEvents()-&gt;clear();</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        m_gui.getPlayerHpChangeEvents()-&gt;clear();</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        m_gui.getPlayerApChangeEvents()-&gt;clear();</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        m_gui.getPlayerAmmoChangeEvents()-&gt;clear();</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#aa52df5643d753b028141331063ce969e">restart</a>(m_pge.getNetwork());</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        m_mapPlayers.clear();</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    }</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    m_pge.getNetwork().WriteList();</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    writePlayerList();</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>}  <span class="comment">// handleUserDisconnected()</span></div>
</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="foldopen" id="foldopen00437" data-start="{" data-end="}">
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a52cdd8dbf8c7cfdb61898577de54045f">  437</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a52cdd8dbf8c7cfdb61898577de54045f">proofps_dd::PlayerHandling::handleUserNameChange</a>(</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    pge_network::PgeNetworkConnectionHandle connHandleServerSide,</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html">proofps_dd::MsgUserNameChangeAndBootupDone</a>&amp; msg,</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config,</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode,</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    PGEcfgProfiles&amp; cfgProfiles)</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>{</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// TODO: make sure received user name is properly null-terminated! someone else could had sent that, e.g. malicious client or server</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="keyword">const</span> <span class="keyword">auto</span> playerIt = m_mapPlayers.find(connHandleServerSide);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == playerIt)</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    {</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to find user with connHandleServerSide: %u!&quot;</span>, __func__, connHandleServerSide);</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span> </div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordflow">if</span> (m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    {</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>        <span class="comment">// sanity check: connHandle should be server&#39;s if bCurrentClient is set</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        <span class="keywordflow">if</span> ((connHandleServerSide == pge_network::ServerConnHandle) &amp;&amp; (!msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">m_bCurrentClient</a>))</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        {</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): cannot happen: connHandleServerSide != pge_network::ServerConnHandle: %u != %u, programming error!&quot;</span>,</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>                __func__, connHandleServerSide, pge_network::ServerConnHandle);</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        }</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span> </div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        <span class="comment">// this is a requested name so this is the place where we make sure name is unique!</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        <span class="keywordtype">char</span> szNewUserName[<span class="keyword">sizeof</span>(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>)];</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        <a class="code hl_function" href="classproofps__dd_1_1_player.html#af70ea5846a878dc57459c73407f4df50">Player::genUniqueUserName</a>(szNewUserName, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, m_mapPlayers);</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        <span class="keywordflow">if</span> (strncmp(szNewUserName, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, <span class="keyword">sizeof</span>(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>)) == 0)</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        {</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>            getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): name change request accepted for connHandleServerSide: %u, old name: %s, new name: %s!&quot;</span>,</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                __func__, connHandleServerSide, playerIt-&gt;second.getName().c_str(), szNewUserName);</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        }</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>        {</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>            getConsole().OLn(<span class="stringliteral">&quot;PlayerHandling::%s(): name change request denied for connHandleServerSide: %u, old name: %s, requested: %s, new name: %s!&quot;</span>,</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                __func__, connHandleServerSide, playerIt-&gt;second.getName().c_str(), msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, szNewUserName);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        }</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        <span class="comment">// server updates player&#39;s name first</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>        playerIt-&gt;second.setName(szNewUserName);</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <span class="comment">// TODO: these commented lines below will be needed when we are allowing player name change WHILE already connected to the server</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>        <span class="comment">// TODO: check if such name is already present in frag table, if so, then rename</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        <span class="comment">//if (!gameMode.renamePlayer(playerIt-&gt;second.getName().c_str(), szNewUserName))</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        <span class="comment">//{</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>        <span class="comment">//    getConsole().EOLn(&quot;PlayerHandling::%s(): gameMode.renamePlayer() FAILED!&quot;, __func__);</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>        <span class="comment">//    assert(false);</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>        <span class="comment">//    return false;</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>        <span class="comment">//}</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <span class="keywordflow">if</span> (!gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#ae5e7dcb0571d7ec80ecb4b4a3e28f02f">addPlayer</a>(playerIt-&gt;second, m_pge.getNetwork()))</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>        {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to insert player %s (%u) into GameMode!&quot;</span>, __func__, szNewUserName, connHandleServerSide);</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        }</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <span class="comment">// then we let all clients except this one know about the name change</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>        pge_network::PgePacket newPktUserNameChange;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a9ac9fc17a117b47ac0c5ad2018c0f3f3">proofps_dd::MsgUserNameChangeAndBootupDone::initPkt</a>(newPktUserNameChange, connHandleServerSide, <span class="keyword">false</span>, szNewUserName))</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>        {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        }</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        m_pge.getNetwork().getServer().sendToAllClientsExcept(newPktUserNameChange, connHandleServerSide);</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span> </div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        <span class="keywordflow">if</span> (connHandleServerSide != pge_network::ServerConnHandle)</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        {</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            m_pge.getNetwork().getServer().setDebugNickname(connHandleServerSide, szNewUserName);</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>            <span class="comment">// we also let this one know its own name change (only if this is not server)</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>            <a class="code hl_struct" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html">proofps_dd::MsgUserNameChangeAndBootupDone</a>&amp; msgUserNameChange = pge_network::PgePacket::getMsgAppDataFromPkt&lt;proofps_dd::MsgUserNameChangeAndBootupDone&gt;(newPktUserNameChange);</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>            msgUserNameChange.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">m_bCurrentClient</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>            m_pge.getNetwork().getServer().send(newPktUserNameChange, connHandleServerSide);</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        }</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <span class="comment">// In the future we need something better than GameMode not having some funcs like getFragLimit()</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_death_match_mode.html">proofps_dd::DeathMatchMode</a>* <span class="keyword">const</span> pDeathMatchMode = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classproofps__dd_1_1_death_match_mode.html">proofps_dd::DeathMatchMode</a>*<span class="keyword">&gt;</span>(&amp;gameMode);</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">if</span> (!pDeathMatchMode)</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        {</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): cast FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        }</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">m_bCurrentClient</a>)</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        {</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>            <span class="comment">// this is the moment when server player has fully booted up</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            <span class="comment">// </span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>            <span class="comment">// server saves this config into the same struct as clients so GUI can show server config on server side as well, from the same struct as clients do!</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a51236e467605ee7b6cf72d3ae493db7c">serverSaveServerInfo</a>(</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>                cfgProfiles.getVars()[CVAR_FPS_MAX].getAsUInt(),</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a4e0f38e01b2d4f170dc4dbcf31147f0b">getTickRate</a>(),</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a01c18f3070aa277e0deb535777fd7d89">getPhysicsRate</a>(),</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a139c5a7ed720493a7d0b8a447a3d3356">getClientUpdateRate</a>(),</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a1ab2cb1ed08c9264b1e29d04ef45bf5d">getGameModeType</a>(),</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a0a4222454fa17c1a020597e131ed48f1">getFragLimit</a>(),</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a41e2d10469dfc7891178ebec90505557">getTimeLimitSecs</a>(),</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a35b1a7fbb39e2bf7de9751cac981dd69">getFallDamageMultiplier</a>(),</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a9fc361308ba044aa97f5b5da5235ea89">getPlayerRespawnDelaySeconds</a>(),</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">getPlayerRespawnInvulnerabilityDelaySeconds</a>());</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>            <span class="comment">// as last step, restart the game mode now, this is important to be last step, for example remaining game time starts to count down now!</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>            gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a89b05fee8a022779887878ef43842dc7">restartWithoutRemovingPlayers</a>(m_pge.getNetwork());</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span> </div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>            <span class="comment">// UPDATE: commented out due to text is now added in GUI::drawCurrentPlayerInfo(), just kept comment here in case we want some other actions in the future</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>            <span class="comment">//m_gui.textPermanent(&quot;Server, User name: &quot; + std::string(szNewUserName) +</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>            <span class="comment">//    (cfgProfiles.getVars()[&quot;testing&quot;].getAsBool() ? &quot;; Testing Mode&quot; : &quot;&quot;),</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            <span class="comment">//    10, 30);</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        }</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        {</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>            <span class="comment">// this is the moment when client player has fully booted up, send server config now, for example remaining game time on client side will start from server&#39;s remaining time</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            <span class="comment">// upon receiving this message</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>            pge_network::PgePacket newPktServerInfo;</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="structproofps__dd_1_1_msg_server_info_from_server.html#a804ef6389636b58d32c17b6223d84cad">proofps_dd::MsgServerInfoFromServer::initPkt</a>(</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>                newPktServerInfo,</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>                cfgProfiles.getVars()[CVAR_FPS_MAX].getAsUInt(),</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a4e0f38e01b2d4f170dc4dbcf31147f0b">getTickRate</a>(),</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a01c18f3070aa277e0deb535777fd7d89">getPhysicsRate</a>(),</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a139c5a7ed720493a7d0b8a447a3d3356">getClientUpdateRate</a>(),</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>                gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a1ab2cb1ed08c9264b1e29d04ef45bf5d">getGameModeType</a>(),</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a0a4222454fa17c1a020597e131ed48f1">getFragLimit</a>(),</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a41e2d10469dfc7891178ebec90505557">getTimeLimitSecs</a>(),</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#abf0d7bd3c3210ff591c5db6847b037aa">getTimeRemainingMillisecs</a>(),</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a35b1a7fbb39e2bf7de9751cac981dd69">getFallDamageMultiplier</a>(),</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a9fc361308ba044aa97f5b5da5235ea89">getPlayerRespawnDelaySeconds</a>(),</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">getPlayerRespawnInvulnerabilityDelaySeconds</a>()))</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>                getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>            }</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>            <span class="comment">// this message will be received by client late enough to make the timeRemainingSecs annoying delayed, so we send updated message a bit later as well in serverSendUserUpdates()</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>            m_pge.getNetwork().getServer().send(newPktServerInfo, connHandleServerSide);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>        }</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        playerIt-&gt;second.setTimeBootedUp();</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <span class="comment">// from our point of view, player has now fully booted up so NOW we are arming the respawn invulnerability</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): Player BOOTED UP, arming 1st-spawn invulnerability for connHandleServerSide: %u!&quot;</span>, __func__, connHandleServerSide);</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>        playerIt-&gt;second.setInvulnerability(<span class="keyword">true</span>, config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">getPlayerRespawnInvulnerabilityDelaySeconds</a>());</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    }</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>        <span class="comment">// if we are client, we MUST NOT receive empty user name from server, so in such case just terminate because there is something fishy!</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <span class="keywordflow">if</span> (strnlen(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, <span class="keyword">sizeof</span>(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>)) == 0)</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        {</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): cannot happen: connHandleServerSide: %u, received empty user name from server!&quot;</span>,</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>                __func__, connHandleServerSide);</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            assert(<span class="keyword">false</span>);  <span class="comment">// in debug mode, raise the debugger</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// for release mode</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        <span class="comment">// TEMPORAL WORKAROUND DUE TO: https://github.com/proof88/PRooFPS-dd/issues/268</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="comment">// we have the same WA in handleUserSetupFromServer().</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        <span class="keyword">const</span> <span class="keyword">auto</span> itPlayerInGamemode = std::find_if(</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#aeb6c97ef0b9c75bc598d8cc85f20e3b4">getFragTable</a>().begin(),</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>            gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#aeb6c97ef0b9c75bc598d8cc85f20e3b4">getFragTable</a>().end(),</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            [&amp;msg](<span class="keyword">const</span> <a class="code hl_struct" href="structproofps__dd_1_1_frag_table_row.html">proofps_dd::FragTableRow</a>&amp; row) { return row.m_sName == msg.m_szUserName; });</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        <span class="keywordflow">if</span> (itPlayerInGamemode != gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#aeb6c97ef0b9c75bc598d8cc85f20e3b4">getFragTable</a>().end())</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>        {</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): WA: connHandleServerSide: %u is already present in GameMode, allowed temporarily due to issue #268 (received: %s; set: %s)!&quot;</span>,</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                __func__, connHandleServerSide, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, playerIt-&gt;second.getName().c_str());</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>        }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        playerIt-&gt;second.setTimeBootedUp();</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): Player BOOTED UP, accepting new name from server for connHandleServerSide: %u (%s), old name: %s, new name: %s!&quot;</span>,</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>            __func__, connHandleServerSide, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">m_bCurrentClient</a> ? <span class="stringliteral">&quot;me&quot;</span> : <span class="stringliteral">&quot;not me&quot;</span>, playerIt-&gt;second.getName().c_str(), msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        playerIt-&gt;second.setName(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>);</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        <span class="comment">// TODO: these commented lines below will be needed when we are allowing player name change WHILE already connected to the server</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="comment">// TODO: check if such name is already present in frag table, if so, then rename</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="comment">//if (!gameMode.renamePlayer(playerIt-&gt;second.getName(), msg.m_szUserName))</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="comment">//{</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        <span class="comment">//    getConsole().EOLn(&quot;PlayerHandling::%s(): gameMode.renamePlayer() FAILED!&quot;, __func__);</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        <span class="comment">//    assert(false);</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        <span class="comment">//    return false;</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="comment">//}</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <span class="keywordflow">if</span> (!gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#ae5e7dcb0571d7ec80ecb4b4a3e28f02f">addPlayer</a>(playerIt-&gt;second, m_pge.getNetwork()))</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        {</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to insert player %s (%u) into GameMode!&quot;</span>, __func__, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">m_szUserName</a>, connHandleServerSide);</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>            assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        }</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>        <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">m_bCurrentClient</a>)</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        {</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>            <span class="comment">// due to difficulties caused by m_gui.textPermanent() it is easier to use it here than in handleUserSetupFromServer()</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            <span class="comment">// UPDATE: commented out due to text is now added in GUI::drawCurrentPlayerInfo(), just kept comment here in case we want some other actions in the future</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>            <span class="comment">//m_gui.textPermanent(&quot;Client, User name: &quot; + playerIt-&gt;second.getName() + &quot;; IP: &quot; + playerIt-&gt;second.getIpAddress() +</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            <span class="comment">//    (cfgProfiles.getVars()[&quot;testing&quot;].getAsBool() ? &quot;; Testing Mode&quot; : &quot;&quot;),</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>            <span class="comment">//    10, 30);</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        }</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    }</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    m_pge.getNetwork().WriteList();</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    writePlayerList();</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>}  <span class="comment">// handleUserNameChange()</span></div>
</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="foldopen" id="foldopen00643" data-start="{" data-end="}">
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a04a40f6863ce9bcb138bd45ea912e43a">  643</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a04a40f6863ce9bcb138bd45ea912e43a">proofps_dd::PlayerHandling::resetSendClientUpdatesCounter</a>(<a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config)</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>{</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="comment">// Config::validate() makes sure neither getTickRate() nor getClientUpdateRate() return 0</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    m_nSendClientUpdatesInEveryNthTick = config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a4e0f38e01b2d4f170dc4dbcf31147f0b">getTickRate</a>() / config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a139c5a7ed720493a7d0b8a447a3d3356">getClientUpdateRate</a>();</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    m_nSendClientUpdatesCntr = m_nSendClientUpdatesInEveryNthTick;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>}</div>
</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span> </div>
<div class="foldopen" id="foldopen00650" data-start="{" data-end="}">
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a1811c440bfb236d166460ff9e2902b62">  650</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a1811c440bfb236d166460ff9e2902b62">proofps_dd::PlayerHandling::serverSendUserUpdates</a>(</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    PGEcfgProfiles&amp; cfgProfiles,</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config,</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    <a class="code hl_struct" href="structproofps__dd_1_1_durations.html">proofps_dd::Durations</a>&amp; durations,</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode)</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>{</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <span class="keywordflow">if</span> (!m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    {</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="comment">// should not happen, but we log it anyway, if in future we might mess up something during a refactor ...</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): NOT server!&quot;</span>, __func__);</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>    }</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keyword">const</span> std::chrono::time_point&lt;std::chrono::steady_clock&gt; timeStart = std::chrono::steady_clock::now();</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bSendUserUpdates = (m_nSendClientUpdatesCntr == m_nSendClientUpdatesInEveryNthTick);</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span> </div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; playerPair : m_mapPlayers)</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    {</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <span class="keyword">auto</span>&amp; player = playerPair.second;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; playerConst = player;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>        <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> nAfterBootUpDelayedUpdateSeconds = 3;</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>        <span class="keywordflow">if</span> (playerConst.isExpectingAfterBootUpDelayedUpdate() &amp;&amp;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>            (playerConst.getTimeBootedUp().time_since_epoch().count() != 0) &amp;&amp;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            ((std::chrono::duration_cast&lt;std::chrono::seconds&gt;(std::chrono::steady_clock::now() - playerConst.getTimeBootedUp()).count()) &gt;= nAfterBootUpDelayedUpdateSeconds))</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>        {</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            player.setExpectingAfterBootUpDelayedUpdate(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>            <span class="comment">// In the future we need something better than GameMode not having some funcs like getFragLimit()</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>            <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_death_match_mode.html">proofps_dd::DeathMatchMode</a>* <span class="keyword">const</span> pDeathMatchMode = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classproofps__dd_1_1_death_match_mode.html">proofps_dd::DeathMatchMode</a>*<span class="keyword">&gt;</span>(&amp;gameMode);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>            <span class="keywordflow">if</span> (!pDeathMatchMode)</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>            {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): cast FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>            }</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span> </div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>            pge_network::PgePacket newPktServerInfo;</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="structproofps__dd_1_1_msg_server_info_from_server.html#a804ef6389636b58d32c17b6223d84cad">proofps_dd::MsgServerInfoFromServer::initPkt</a>(</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>                newPktServerInfo,</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>                cfgProfiles.getVars()[CVAR_FPS_MAX].getAsUInt(),</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a4e0f38e01b2d4f170dc4dbcf31147f0b">getTickRate</a>(),</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a01c18f3070aa277e0deb535777fd7d89">getPhysicsRate</a>(),</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a139c5a7ed720493a7d0b8a447a3d3356">getClientUpdateRate</a>(),</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a1ab2cb1ed08c9264b1e29d04ef45bf5d">getGameModeType</a>(),</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a0a4222454fa17c1a020597e131ed48f1">getFragLimit</a>(),</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#a41e2d10469dfc7891178ebec90505557">getTimeLimitSecs</a>(),</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>                pDeathMatchMode-&gt;<a class="code hl_function" href="classproofps__dd_1_1_death_match_mode.html#abf0d7bd3c3210ff591c5db6847b037aa">getTimeRemainingMillisecs</a>(),</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a35b1a7fbb39e2bf7de9751cac981dd69">getFallDamageMultiplier</a>(),</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#a9fc361308ba044aa97f5b5da5235ea89">getPlayerRespawnDelaySeconds</a>(),</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>                config.<a class="code hl_function" href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">getPlayerRespawnInvulnerabilityDelaySeconds</a>()))</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>            {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>                getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>            }</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>            m_pge.getNetwork().getServer().send(newPktServerInfo, playerPair.first);</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>            getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): WA: sent out after-bootup delayed update to: %u&quot;</span>, __func__, playerPair.first);</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>        } <span class="comment">// isExpectingAfterBootUpDelayedUpdate()</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        <span class="keywordflow">if</span> (bSendUserUpdates &amp;&amp; player.isNetDirty())</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            pge_network::PgePacket newPktUserUpdate;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): send 1!&quot;, __func__);</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="structproofps__dd_1_1_msg_user_update_from_server.html#afca442c02e1d376443c47c34bbb3667f">proofps_dd::MsgUserUpdateFromServer::initPkt</a>(</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>                newPktUserUpdate,</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>                playerPair.second.getServerSideConnectionHandle(),</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                playerConst.getPos().getNew().getX(),</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                playerConst.getPos().getNew().getY(),</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                playerConst.getPos().getNew().getZ(),</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                playerConst.getAngleY(),</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                playerConst.getAngleZ(),</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                player.getWeaponAngle().getNew().getZ(),</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                playerConst.getWeaponMomentaryAccuracy(),</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                player.getCrouchStateCurrent(),</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                player.getSomersaultAngle(),</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                playerConst.getArmor().getNew(),</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                playerConst.getHealth().getNew(),</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                player.getRespawnFlag(),</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                playerConst.getFrags(),</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                playerConst.getDeaths(),</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                playerConst.getInvulnerability()))</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                player.clearNetDirty();</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span> </div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                <span class="comment">//if (playerPair.second.getRespawnFlag())</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                <span class="comment">//{</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                <span class="comment">//    getConsole().EOLn(</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>                <span class="comment">//        &quot;%s(): player XY: %f, %f&quot;,</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <span class="comment">//        __func__,</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                <span class="comment">//        player.getPos().getNew().getX(), player.getPos().getNew().getY());</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                <span class="comment">//}</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span> </div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>                <span class="comment">// we always reset respawn flag here</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>                playerPair.second.getRespawnFlag() = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                <span class="comment">// Note that health is not needed by server since it already has the updated health, but for convenience</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                <span class="comment">// we put that into MsgUserUpdateFromServer and send anyway like all the other stuff.</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                m_pge.getNetwork().getServer().sendToAll(newPktUserUpdate);</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>                <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): send 2, invul: %b!&quot;, __func__, playerConst.getInvulnerability());</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            }</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>            {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): initPkt() FAILED at line %d!&quot;</span>, __func__, __LINE__);</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>            }</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>        } <span class="comment">// bSendUserUpdates</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    }  <span class="comment">// for playerPair</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="keywordflow">if</span> (bSendUserUpdates)</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>    {</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        m_nSendClientUpdatesCntr = 0;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="comment">// measure duration only if we really sent the user updates to clients</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        durations.<a class="code hl_variable" href="structproofps__dd_1_1_durations.html#ab8c861d7c1b35fec3fc3bf20ee61d5cb">m_nSendUserUpdatesDurationUSecs</a> += std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(std::chrono::steady_clock::now() - timeStart).count();</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    }</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    ++m_nSendClientUpdatesCntr;</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>} <span class="comment">// serverSendUserUpdates()</span></div>
</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="foldopen" id="foldopen00770" data-start="{" data-end="}">
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a7c7c79f4e16ede0bcc2f52f059e8469b">  770</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a7c7c79f4e16ede0bcc2f52f059e8469b">proofps_dd::PlayerHandling::handleUserUpdateFromServer</a>(</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    pge_network::PgeNetworkConnectionHandle connHandleServerSide,</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structproofps__dd_1_1_msg_user_update_from_server.html">proofps_dd::MsgUserUpdateFromServer</a>&amp; msg,</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <a class="code hl_class" href="classproofps__dd_1_1_x_hair.html">XHair</a>&amp; xhair,</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; <span class="comment">/*config*/</span>,</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode)</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>{</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>    <span class="comment">// Due to https://github.com/proof88/PRooFPS-dd/issues/268, we need to apply WA here.</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>    <span class="comment">// Explained in details in handlePlayerEventFromServer().</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>    <span class="comment">// Due to this, now this WA is applied: return true from non-serveronly msg handling functions if connHandle is not found in m_mapPlayers.</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="keyword">const</span> <span class="keyword">auto</span> it = m_mapPlayers.find(connHandleServerSide);</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == it)</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    {</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to find user with connHandleServerSide: %u, WA in place, ignoring error!&quot;</span>, __func__, connHandleServerSide);</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// WA</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    }</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span> </div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bCurrentClient = isMyConnection(connHandleServerSide);</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    <span class="keyword">auto</span>&amp; player = it-&gt;second;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; playerConst = player;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="comment">//getConsole().OLn(&quot;PlayerHandling::%s(): user %s received MsgUserUpdateFromServer: %f&quot;, __func__, player.getName().c_str(), msg.m_pos.x);</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bOriginalExpectingStartPos = player.isJustCreatedAndExpectingStartPos();</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    <span class="keywordflow">if</span> (player.isJustCreatedAndExpectingStartPos())</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    {</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>        <span class="comment">// Player object is recently constructed and this is the 1st MsgUserUpdateFromServer for this Player</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        player.setJustCreatedAndExpectingStartPos(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>        <span class="comment">// PPPKKKGGGGGG</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>        player.getPos().set(PureVector(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.x, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.y, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.z));</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        player.getPos().commit(); <span class="comment">// both server and client commits in this case</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        player.setHasJustStartedFallingNaturallyInThisTick(<span class="keyword">true</span>);  <span class="comment">// make sure vars for calculating high fall are reset</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span> </div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <span class="keywordflow">if</span> (m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>        {</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>            <span class="comment">// When Player is spawned for the 1st time, it is not a &quot;re-&quot;spawn, but we should still apply invulnerability since</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>            <span class="comment">// this player has not yet fully booted up but gets visible to other players so we keep protected from other players.</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>            <span class="comment">// I could not find a better place for this (MsgUserConnected, MsgUserSetupFromServer, etc.), so here we are forcing it.</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): 1st spawn: forced invulnerability for connHandleServerSide: %u!&quot;, __func__, connHandleServerSide);</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>            player.setInvulnerability(<span class="keyword">true</span>, 999);</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        }</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>        {</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            player.setInvulnerability(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a6fef448775b585aec29e90ae93806212">m_bInvulnerability</a>);</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>            <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): 1st spawn: initial invulnerability for connHandleServerSide: %u!&quot;, __func__, connHandleServerSide);</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>        }</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>    }</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        <span class="keywordflow">if</span> (!m_pge.getNetwork().isServer() &amp;&amp; (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a6fef448775b585aec29e90ae93806212">m_bInvulnerability</a> != player.getInvulnerability()))</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        {</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            <span class="comment">// only clients should fall here, server sets invulnerability in other locations and doesnt need to update itself here!           </span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>            <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): new invulnerability state %b for connHandleServerSide: %u!&quot;, __func__, msg.m_bInvulnerability, connHandleServerSide);</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>            <span class="comment">// no need to set time for clients even if state is true, since player.update() is not allowed to stop invulnerability on client-side.</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            player.setInvulnerability(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a6fef448775b585aec29e90ae93806212">m_bInvulnerability</a>);</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>        }</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    }</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    <span class="comment">// server has already set this in input handling and/or physics, however probably this is still faster than with condition: if (!m_pge.getNetwork().isServer())</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    player.setSomersaultClient(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#aaf4bf5e4a99ea8728f9a68d48c38a7f9">m_fSomersaultAngle</a>);</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    <span class="comment">//getConsole().OLn(&quot;PlayerHandling::%s(): rcvd crouch: %b&quot;, __func__, msg.m_bCrouch);</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>    <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a3c2bfeb5875a25d325c1b6b5634f1cfb">m_bCrouch</a>)</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="comment">// server had already set stuff since it relayed this to clients, however</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>        <span class="comment">// there is no use of adding extra condition for checking if we are server or client</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        player.doCrouchShared();</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>        player.doStandupShared();</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    }</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span> </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    player.getPos().set(PureVector(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.x, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.y, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.z)); <span class="comment">// server does not commit here, client commits few lines below by invoking updateOldValues()</span></div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>    player.getObject3D()-&gt;getPosVec().Set(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.x, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.y, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">m_pos</a>.z);</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    player.getWeaponManager().getCurrentWeapon()-&gt;UpdatePosition(player.getObject3D()-&gt;getPosVec(), player.isSomersaulting());</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span> </div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>    <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#aa6ee6516128b803afe41cd4f299566c0">m_fPlayerAngleY</a> != -1.f)</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>    {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>        <span class="comment">//player.getAngleY() = msg.m_fPlayerAngleY;  // not sure why this is commented</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>        player.getObject3D()-&gt;getAngleVec().SetY(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#aa6ee6516128b803afe41cd4f299566c0">m_fPlayerAngleY</a>);</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    }</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>    player.getObject3D()-&gt;getAngleVec().SetZ(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a5025f12fb19bf07c0785da834f3f68e7">m_fPlayerAngleZ</a>);</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>    player.getWeaponManager().getCurrentWeapon()-&gt;getObject3D().getAngleVec().SetY(player.getObject3D()-&gt;getAngleVec().getY());</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    player.getWeaponManager().getCurrentWeapon()-&gt;getObject3D().getAngleVec().SetZ(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a78d3e482756d74f00bdf77d3d25788b1">m_fWpnAngleZ</a>);</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span> </div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>    player.setWeaponMomentaryAccuracy(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a2e1cb30d6f1de1f77d0a2d58cac4f45d">m_fWpnMomentaryAccuracy</a>);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    <span class="keywordflow">if</span> (bCurrentClient)</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    {</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        <span class="comment">// note that if we change values here, then setBaseScaling() might also need to be adjusted in GUI init!</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>        m_gui.getXHair()-&gt;setRelativeScaling(</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>            PFL::lerp(0.5f, 1.2f, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a2e1cb30d6f1de1f77d0a2d58cac4f45d">m_fWpnMomentaryAccuracy</a> / player.getWeaponManager().getCurrentWeapon()-&gt;getLowestAccuracyPossible())</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        );</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    }</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span> </div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    player.getFrags() = msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a50bd6aa4405a8596b51f80a09de7e420">m_nFrags</a>;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    player.getDeaths() = msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a48e144412ea58a1c233756ec96eceec8">m_nDeaths</a>;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): rcvd health: %d, health: %d, old health: %d&quot;,</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="comment">//    __func__, msg.m_nHealth, std::as_const(player).getHealth(), std::as_const(player).getHealth().getOld());</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    player.setArmor(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a4768390cbc2b13324833dd2e8367b479">m_nArmor</a>);</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    player.setHealth(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a13064d4585969e06a74a7c49ad54f2a5">m_nHealth</a>);</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <span class="keywordflow">if</span> (bCurrentClient)</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    {</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <span class="comment">// !!!BESTPRACTICE!!!</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        <span class="comment">// Server already has both new and old HP updated when we get here, and msg.m_nHealth contains the same value obviously.</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>        <span class="comment">// So the easiest trick is to have a static var so we always know the old HP, no matter if we are server or client.</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        <span class="comment">// This way server and client can have this same shared code, instead of only client doing it here, and server doing it</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>        <span class="comment">// at some other place.</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>        <span class="comment">// Obviously it would be better if server would NOT update these values before injecting MsgUserUpdate but now this is</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>        <span class="comment">// how it is.</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        <span class="keyword">static</span> <span class="keywordtype">int</span> nPrevHP = 100;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        <span class="keyword">static</span> <span class="keywordtype">int</span> nPrevAP = 0;</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span> </div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        <span class="keywordflow">if</span> (bOriginalExpectingStartPos || msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a0b18bf711ca01b4b5fb63e459bcefb48">m_bRespawn</a>)</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>        {</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            <span class="comment">// We might be after map change, do not show any HP change for refilled HP!</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>            <span class="comment">// Even though Player instances are recreated, this static var remembers, so we need to reset it.</span></div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>            nPrevHP = 100;</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            nPrevAP = 0;</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="keywordflow">if</span> (std::as_const(player).getHealth() != nPrevHP)</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            {</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                assert(m_gui.getPlayerHpChangeEvents());</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                <span class="keyword">const</span> <span class="keywordtype">int</span> nHpChange = std::as_const(player).getHealth() - nPrevHP;</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                <span class="comment">// As of v0.2.8 the max HP is 100, and we should not list +100% as HP change because that is basically respawn, and</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                <span class="comment">// when it happens, it is obvious to the player so don&#39;t make HP change event for that.</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>                <span class="keywordflow">if</span> (nHpChange &lt; 100)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>                {</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                    m_gui.getPlayerHpChangeEvents()-&gt;addEvent(std::to_string(nHpChange));</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                }</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span> </div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                nPrevHP = std::as_const(player).getHealth();</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>            }</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            <span class="keywordflow">if</span> (std::as_const(player).getArmor() != nPrevAP)</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            {</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>                assert(m_gui.getPlayerApChangeEvents());</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                <span class="keyword">const</span> <span class="keywordtype">int</span> nApChange = std::as_const(player).getArmor() - nPrevAP;</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span> </div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>                m_gui.getPlayerApChangeEvents()-&gt;addEvent(std::to_string(nApChange));</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>                nPrevAP = std::as_const(player).getArmor();</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>            }</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>        }</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>    }</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_user_update_from_server.html#a0b18bf711ca01b4b5fb63e459bcefb48">m_bRespawn</a>)</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    {</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <span class="comment">//getConsole().OLn(&quot;PlayerHandling::%s(): player %s has respawned!&quot;, __func__, player.getName().c_str());</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        handlePlayerRespawned(player, xhair);</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    {</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        <span class="keywordflow">if</span> ((playerConst.getHealth().getOld() &gt; 0) &amp;&amp; (playerConst.getHealth() == 0))</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>        {</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            <span class="comment">// only clients fall here, since server already set oldhealth to 0 at the beginning of this frame</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            <span class="comment">// because it had already set health to 0 in previous frame</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>            <span class="comment">//getConsole().OLn(&quot;PlayerHandling::%s(): player %s has died!&quot;, __func__, player.getName().c_str());</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            handlePlayerDied(player, xhair, player.getServerSideConnectionHandle() <span class="comment">/* ignored by client anyway */</span>, gameMode);</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            <span class="comment">// TODO: until v0.2.0.0 this was the only location where client could figure out if any player died, however</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            <span class="comment">// now we have handleDeathNotificationFromServer(), we could simply move this code to there!</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <span class="comment">// Client does not invoke HandlePlayerDied() anywhere else.</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>        }</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>    }</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>    <span class="comment">// We might receive update for another player who has not yet handshaked its name with the server, in that case the name is empty, that</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>    <span class="comment">// is why we also need to check emptiness!</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>    <span class="comment">// Also, we should not try update ourselves in GameMode if bOriginalExpectingStartPos is set because that also means that</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    <span class="comment">// we not yet handshaked our own name with the server (but on our side our name is not empty, so we need this complicated logic below).</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <span class="keywordflow">if</span> (!player.getName().empty())</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    {</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        <span class="keywordflow">if</span> (!bCurrentClient || (bCurrentClient &amp;&amp; !bOriginalExpectingStartPos))</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        {</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>            <span class="keywordflow">if</span> (!gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a96b91a42a320a2d09c0fc727a2ef2930">updatePlayer</a>(player, m_pge.getNetwork()))</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>            {</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>                getConsole().EOLn(<span class="stringliteral">&quot;%s: failed to update player %s in GameMode!&quot;</span>, __func__, player.getName().c_str());</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            }</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        }</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    }</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span> </div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    <span class="keywordflow">if</span> (!m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    {</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        <span class="comment">// server already invoked updateOldValues() when it sent out this update message</span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        player.updateOldValues();</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    }</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span> </div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>}  <span class="comment">// handleUserUpdateFromServer()</span></div>
</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="foldopen" id="foldopen00965" data-start="{" data-end="}">
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#ad6b307745116ba6177a917c4fffb55a7">  965</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#ad6b307745116ba6177a917c4fffb55a7">proofps_dd::PlayerHandling::handleDeathNotificationFromServer</a>(pge_network::PgeNetworkConnectionHandle nDeadConnHandleServerSide, <span class="keyword">const</span> <a class="code hl_struct" href="structproofps__dd_1_1_msg_death_notification_from_server.html">proofps_dd::MsgDeathNotificationFromServer</a>&amp; msg)</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>{</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <span class="keywordflow">if</span> (m_pge.getNetwork().isServer())</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    {</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): server received, CANNOT HAPPEN!&quot;</span>, __func__);</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        assert(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    }</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span> </div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): player %u killed by %u&quot;,  __func__, nDeadConnHandleServerSide, msg.m_nKillerConnHandleServerSide);</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>    <span class="comment">// Due to https://github.com/proof88/PRooFPS-dd/issues/268, we need to apply WA here.</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    <span class="comment">// Explained in details in handlePlayerEventFromServer().</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="comment">// Due to this, now this WA is applied: return true from non-serveronly msg handling functions if connHandle is not found in m_mapPlayers.</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="keyword">const</span> <span class="keyword">auto</span> itPlayerDied = m_mapPlayers.find(nDeadConnHandleServerSide);</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == itPlayerDied)</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    {</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to find dead with connHandleServerSide: %u, WA in place, ignoring error!&quot;</span>, __func__, nDeadConnHandleServerSide);</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>        <span class="comment">//assert(false);</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// WA</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    }</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    std::string sKillerName;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <span class="keyword">const</span> <span class="keyword">auto</span> itPlayerKiller = m_mapPlayers.find(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_death_notification_from_server.html#a45c806f698b421471b9111053d161063">m_nKillerConnHandleServerSide</a>);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == itPlayerKiller)</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    {</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to find killer with connHandleServerSide: %u!&quot;</span>, __func__, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_death_notification_from_server.html#a45c806f698b421471b9111053d161063">m_nKillerConnHandleServerSide</a>);</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        assert(<span class="keyword">false</span>); <span class="comment">// crash in debug, ignore in release mode: a bullet killing someone might be shot by a killer already disconnected before the impact,</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        <span class="comment">// however this is not likely to happen in debug mode when I&#39;m testing regular gameplay!</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    }</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    {</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>        <span class="comment">// killer connhandle is set to player&#39;s connhandle also if killer got disconnected in the meantime, so that is not necessarily suicide!</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>        <span class="keywordflow">if</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_death_notification_from_server.html#a45c806f698b421471b9111053d161063">m_nKillerConnHandleServerSide</a> != nDeadConnHandleServerSide)</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>        {</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>            sKillerName = itPlayerKiller-&gt;second.getName();</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        }</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    }</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span> </div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="comment">// from v0.2.5, client shows respawn timer here instead of in handlePlayerDied()</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">if</span> (isMyConnection(nDeadConnHandleServerSide))</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    {</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>        m_gui.showRespawnTimer(</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>            sKillerName.empty() ? <span class="keyword">nullptr</span> : &amp;(itPlayerKiller-&gt;second));</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    }</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span> </div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <span class="comment">// Server does death notification on GUI in HandlePlayerDied(), clients do here.</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    assert(m_gui.getDeathKillEvents());</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    m_gui.getDeathKillEvents()-&gt;addDeathKillEvent(sKillerName, itPlayerDied-&gt;second.getName());</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span> </div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>}</div>
</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span> </div>
<div class="foldopen" id="foldopen01018" data-start="{" data-end="}">
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a1184e42672d691213dc0e7f5b20be4ac"> 1018</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a1184e42672d691213dc0e7f5b20be4ac">proofps_dd::PlayerHandling::handlePlayerEventFromServer</a>(pge_network::PgeNetworkConnectionHandle connHandleServerSide, <span class="keyword">const</span> <a class="code hl_struct" href="structproofps__dd_1_1_msg_player_event_from_server.html">proofps_dd::MsgPlayerEventFromServer</a>&amp; msg)</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>{</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): received event id: %u about player with connHandleServerSide: %u!&quot;, __func__, msg.m_iPlayerEventId, connHandleServerSide);</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="comment">// !!!BADDESIGN!!!</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    <span class="comment">// https://github.com/proof88/PRooFPS-dd/issues/268</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="comment">// Because of this issue, it can happen that a newly connecting client who not yet has received the list of other players, receives a player related update</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <span class="comment">// like this. This typically happens when server uses sendToAllClientsExcept():</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <span class="comment">// Flow is like:</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="comment">// - new client is connecting, accepted at server GNS/PGE level;</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <span class="comment">// - server PGE invokes server APP packet handling callbacks, APP handles MsgUserConnected, injects MsgUserSetup;</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="comment">// - server PGE invokes onGameRunning(), server APP identifies a new event, informs players about it using sendToAllClientsExcept();</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <span class="comment">// - new client receives message about a player it does NOT yet know, here the error can occur;</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    <span class="comment">// - server would send the list of other players to the new client only in next loop&#39;s packet handling, when processing the injected MsgUserSetup.</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    <span class="comment">// Until a good solution is provided, workaround is to NOT to treat such error on client side as critical, just ignoring that message.</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>    <span class="comment">// One solution I can think about is that APP layer must use its own layer for sending out packets, for those who are present in the m_mapPlayers list.</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>    <span class="comment">// Not directly calling PGE networking functions.</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    <span class="comment">// This would be a thin layer over PGE networking functions.</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="comment">// Due to this, now this WA is applied: return true from non-serveronly msg handling functions if connHandle is not found in m_mapPlayers.</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <span class="keyword">const</span> <span class="keyword">auto</span> it = m_mapPlayers.find(connHandleServerSide);</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keywordflow">if</span> (m_mapPlayers.end() == it)</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): failed to find user with connHandleServerSide: %u, WA in place, ignoring error!&quot;</span>, __func__, connHandleServerSide);</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// WA</span></div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>    }</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bCurrentClient = isMyConnection(connHandleServerSide);</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>    <span class="keyword">auto</span>&amp; player = it-&gt;second;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>    <span class="comment">// PlayerEventId</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>    <span class="keywordflow">switch</span> (msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#aedda6566b3a5d3b305dd7b773addf8dc">m_iPlayerEventId</a>)</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    {</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0a9415785dfe55fa63c575ed88a9aef470">PlayerEventId::FallingFromHigh</a>:</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>        player.handleFallingFromHigh(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#a0ace14cba7a39ecedc51c656444e363f">m_optData1</a>.<a class="code hl_variable" href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a292a07e14d4f87b26afbfe96280d8fac">m_nValue</a>);</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0af20f2c60887f554cfaabb224a1c1a906">PlayerEventId::Landed</a>:</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        player.handleLanded(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#a0ace14cba7a39ecedc51c656444e363f">m_optData1</a>.<a class="code hl_variable" href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#acd17d377f6f20f4481073749f140d741">m_fValue</a>, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#aee88f64a842f84420ce488b858c06fb6">m_optData2</a>.<a class="code hl_variable" href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a9fa2973260c721da1b12ced0c1731044">m_bValue</a>, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#aa0559ff7fed50338f2d4cf92ed7f69d4">m_optData3</a>.<a class="code hl_variable" href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a9fa2973260c721da1b12ced0c1731044">m_bValue</a>);</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0acb1ff80e06f10421b852d35a0a8752c3">PlayerEventId::ItemTake</a>:</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>        assert(bCurrentClient);</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>        player.handleTakeNonWeaponItem(<span class="keyword">static_cast&lt;</span><a class="code hl_enumeration" href="namespaceproofps__dd.html#a24042733b4a94a708bb71a5f9a9a254a">MapItemType</a><span class="keyword">&gt;</span>(msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#a0ace14cba7a39ecedc51c656444e363f">m_optData1</a>.<a class="code hl_variable" href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a292a07e14d4f87b26afbfe96280d8fac">m_nValue</a>));</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0ad345e02203e21c17700641e2e42515d3">PlayerEventId::JumppadActivated</a>:</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>        assert(bCurrentClient);</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        player.handleJumppadActivated();</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        getConsole().EOLn(<span class="stringliteral">&quot;PlayerHandling::%s(): bad event id: %u about player with connHandleServerSide: %u!&quot;</span>, __func__, msg.<a class="code hl_variable" href="structproofps__dd_1_1_msg_player_event_from_server.html#aedda6566b3a5d3b305dd7b773addf8dc">m_iPlayerEventId</a>, connHandleServerSide);</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>        assert(<span class="keyword">false</span>);  <span class="comment">// crash in debug</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    }</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span> </div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>}</div>
</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="foldopen" id="foldopen01074" data-start="{" data-end="}">
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"><a class="line" href="classproofps__dd_1_1_player_handling.html#a6d7317ea69b571a199e4bd58fb9b6630"> 1074</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classproofps__dd_1_1_player_handling.html#a6d7317ea69b571a199e4bd58fb9b6630">proofps_dd::PlayerHandling::updatePlayersVisuals</a>(</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    <span class="keyword">const</span> <a class="code hl_class" href="classproofps__dd_1_1_config.html">proofps_dd::Config</a>&amp; config,</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    <a class="code hl_class" href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a>&amp; gameMode)</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>{</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="comment">// both client and server come here, so this is a great place to HIDE respawn countdown for player if game has been won in the meantime.</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    <span class="comment">// as of v0.2.4 this is invoked in every frame so this is great!</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    <span class="keywordflow">if</span> (gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a72d2bde6d117d2c0b9ce3e5b4f3d8f73">isGameWon</a>())</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    {</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        m_gui.hideRespawnTimer();</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    }</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span> </div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> bXHairIdentifiesPlayers = m_pge.getConfigProfiles().getVars()[<a class="code hl_variable" href="classproofps__dd_1_1_x_hair.html#a016f10312d3d32b23ce96aab0a7d74d0">XHair::szCvarGuiXHairIdentifiesPlayers</a>].getAsBool();</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    m_gui.getXHair()-&gt;hideIdText();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; playerPair : m_mapPlayers)</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    {</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="keyword">auto</span>&amp; player = playerPair.second;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span> </div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        player.updateAudioVisuals(config, m_pge.getNetwork().isServer());</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="keywordflow">if</span> (bXHairIdentifiesPlayers)</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        {</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            <span class="comment">// it does not matter if we iterate from the back or the front, because players are ordered in the map by their conn handle, which</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>            <span class="comment">// is not continuously increasing, so the latest added player might not be the last player in the map.</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>            <span class="comment">// At the same time, when players are overlapping, the later added player is rendered over the earlier added player, which would imply</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>            <span class="comment">// that in such situation the later added player&#39;s name is preferred to be shown, but it is not the case due to the order in the map.</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>            <span class="comment">// To solve this, there should be also a different map where players are ordered by their connection time, and we should iterate that.</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>            <span class="comment">// Opened ticket for this bug: https://github.com/proof88/PRooFPS-dd/issues/323</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>            <span class="keywordflow">if</span> (!gameMode.<a class="code hl_function" href="classproofps__dd_1_1_game_mode.html#a72d2bde6d117d2c0b9ce3e5b4f3d8f73">isGameWon</a>() &amp;&amp;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                m_gui.getXHair()-&gt;getIdText().empty() &amp;&amp;</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>                !isMyConnection(playerPair.first) &amp;&amp;</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>                (std::as_const(player).getObject3D()-&gt;isRenderingAllowed()) &amp;&amp;</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                (std::as_const(player).getHealth() &gt; 0) &amp;&amp;</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                <a class="code hl_function" href="classproofps__dd_1_1_physics.html#a928e517801089c65b6816bd10376bffc">Physics::colliding2_NoZ</a>(</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                    player.getObject3D()-&gt;getPosVec().getX(), player.getObject3D()-&gt;getPosVec().getY(),</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>                    player.getObject3D()-&gt;getScaledSizeVec().getX(), player.getObject3D()-&gt;getScaledSizeVec().getY(),</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>                    m_gui.getXHair()-&gt;getUnprojectedCoords().getX(), m_gui.getXHair()-&gt;getUnprojectedCoords().getY(),</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>                    <span class="comment">/* virtual 3D size of xhair */</span> 0.02f, 0.02f))</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            {</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                m_gui.getXHair()-&gt;showIdText(</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>                    player.getName() +</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>                    <span class="stringliteral">&quot; | (&quot;</span> + std::to_string(std::as_const(player).getHealth().getNew()) + </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>                    <span class="stringliteral">&quot; / &quot;</span> + std::to_string(std::as_const(player).getArmor().getNew()) + <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>                );</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>                <span class="comment">//getConsole().EOLn(&quot;PlayerHandling::%s(): xhair hit player: %s!&quot;, __func__, player.getName().c_str());</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>            }</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        }</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    }</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>}</div>
</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span> </div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span><span class="comment">// ############################### PRIVATE ###############################</span></div>
<div class="ttc" id="a_p_roo_f_p_s-dd-packet_8h_html"><div class="ttname"><a href="_p_roo_f_p_s-dd-packet_8h.html">PRooFPS-dd-packet.h</a></div></div>
<div class="ttc" id="a_physics_8h_html"><div class="ttname"><a href="_physics_8h.html">Physics.h</a></div></div>
<div class="ttc" id="a_player_handling_8h_html"><div class="ttname"><a href="_player_handling_8h.html">PlayerHandling.h</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html"><div class="ttname"><a href="classproofps__dd_1_1_config.html">proofps_dd::Config</a></div><div class="ttdef"><b>Definition</b> <a href="_config_8h_source.html#l00081">Config.h:82</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a01c18f3070aa277e0deb535777fd7d89"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a01c18f3070aa277e0deb535777fd7d89">proofps_dd::Config::getPhysicsRate</a></div><div class="ttdeci">const unsigned int &amp; getPhysicsRate() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00352">Config.cpp:352</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a139c5a7ed720493a7d0b8a447a3d3356"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a139c5a7ed720493a7d0b8a447a3d3356">proofps_dd::Config::getClientUpdateRate</a></div><div class="ttdeci">const unsigned int &amp; getClientUpdateRate() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00357">Config.cpp:357</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a35b1a7fbb39e2bf7de9751cac981dd69"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a35b1a7fbb39e2bf7de9751cac981dd69">proofps_dd::Config::getFallDamageMultiplier</a></div><div class="ttdeci">const int &amp; getFallDamageMultiplier() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00387">Config.cpp:387</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a4e0f38e01b2d4f170dc4dbcf31147f0b"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a4e0f38e01b2d4f170dc4dbcf31147f0b">proofps_dd::Config::getTickRate</a></div><div class="ttdeci">const unsigned int &amp; getTickRate() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00347">Config.cpp:347</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a51236e467605ee7b6cf72d3ae493db7c"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a51236e467605ee7b6cf72d3ae493db7c">proofps_dd::Config::serverSaveServerInfo</a></div><div class="ttdeci">void serverSaveServerInfo(const unsigned int &amp;nMaxFps, const unsigned int &amp;nTickrate, const unsigned int &amp;nPhysicsRateMin, const unsigned int &amp;nClientUpdateRate, const GameModeType &amp;iGameModeType, const unsigned int &amp;nFragLimit, const unsigned int &amp;nTimeLimitSecs, const int &amp;nFallDamageMultiplier, const unsigned int &amp;nRespawnTimeSecs, const unsigned int &amp;nRespawnInvulnerabilityTimeSec)</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00456">Config.cpp:456</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_a9fc361308ba044aa97f5b5da5235ea89"><div class="ttname"><a href="classproofps__dd_1_1_config.html#a9fc361308ba044aa97f5b5da5235ea89">proofps_dd::Config::getPlayerRespawnDelaySeconds</a></div><div class="ttdeci">const unsigned int &amp; getPlayerRespawnDelaySeconds() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00392">Config.cpp:392</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_config_html_aae454c65850c5eb92463045344f0d45f"><div class="ttname"><a href="classproofps__dd_1_1_config.html#aae454c65850c5eb92463045344f0d45f">proofps_dd::Config::getPlayerRespawnInvulnerabilityDelaySeconds</a></div><div class="ttdeci">const unsigned int &amp; getPlayerRespawnInvulnerabilityDelaySeconds() const</div><div class="ttdef"><b>Definition</b> <a href="_config_8cpp_source.html#l00397">Config.cpp:397</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_death_match_mode_html"><div class="ttname"><a href="classproofps__dd_1_1_death_match_mode.html">proofps_dd::DeathMatchMode</a></div><div class="ttdoc">In DeathMatch a.k.a.</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8h_source.html#l00242">GameMode.h:243</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_death_match_mode_html_a0a4222454fa17c1a020597e131ed48f1"><div class="ttname"><a href="classproofps__dd_1_1_death_match_mode.html#a0a4222454fa17c1a020597e131ed48f1">proofps_dd::DeathMatchMode::getFragLimit</a></div><div class="ttdeci">unsigned int getFragLimit() const</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00306">GameMode.cpp:306</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_death_match_mode_html_a41e2d10469dfc7891178ebec90505557"><div class="ttname"><a href="classproofps__dd_1_1_death_match_mode.html#a41e2d10469dfc7891178ebec90505557">proofps_dd::DeathMatchMode::getTimeLimitSecs</a></div><div class="ttdeci">unsigned int getTimeLimitSecs() const</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00263">GameMode.cpp:263</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_death_match_mode_html_abf0d7bd3c3210ff591c5db6847b037aa"><div class="ttname"><a href="classproofps__dd_1_1_death_match_mode.html#abf0d7bd3c3210ff591c5db6847b037aa">proofps_dd::DeathMatchMode::getTimeRemainingMillisecs</a></div><div class="ttdeci">unsigned int getTimeRemainingMillisecs() const</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00273">GameMode.cpp:273</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_g_u_i_html"><div class="ttname"><a href="classproofps__dd_1_1_g_u_i.html">proofps_dd::GUI</a></div><div class="ttdef"><b>Definition</b> <a href="_g_u_i_8h_source.html#l00035">GUI.h:36</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html">proofps_dd::GameMode</a></div><div class="ttdoc">GameMode class represent the Frag Table and the winning condition checks.</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8h_source.html#l00056">GameMode.h:57</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_a1ab2cb1ed08c9264b1e29d04ef45bf5d"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#a1ab2cb1ed08c9264b1e29d04ef45bf5d">proofps_dd::GameMode::getGameModeType</a></div><div class="ttdeci">GameModeType getGameModeType() const</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00050">GameMode.cpp:50</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_a72d2bde6d117d2c0b9ce3e5b4f3d8f73"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#a72d2bde6d117d2c0b9ce3e5b4f3d8f73">proofps_dd::GameMode::isGameWon</a></div><div class="ttdeci">bool isGameWon() const</div><div class="ttdoc">Returns the current game session win state i.e.</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00085">GameMode.cpp:85</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_a89b05fee8a022779887878ef43842dc7"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#a89b05fee8a022779887878ef43842dc7">proofps_dd::GameMode::restartWithoutRemovingPlayers</a></div><div class="ttdeci">virtual void restartWithoutRemovingPlayers(pge_network::PgeINetwork &amp;network)</div><div class="ttdoc">Resets winning time and winning condition, also zeros out relevant members of FragTableRow for all pl...</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00067">GameMode.cpp:67</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_a96b91a42a320a2d09c0fc727a2ef2930"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#a96b91a42a320a2d09c0fc727a2ef2930">proofps_dd::GameMode::updatePlayer</a></div><div class="ttdeci">virtual bool updatePlayer(const Player &amp;player, pge_network::PgeINetwork &amp;network)=0</div><div class="ttdoc">Updates data for the specified player.</div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_aa52df5643d753b028141331063ce969e"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#aa52df5643d753b028141331063ce969e">proofps_dd::GameMode::restart</a></div><div class="ttdeci">virtual void restart(pge_network::PgeINetwork &amp;network)</div><div class="ttdoc">Similar to restartWithoutRemovingPlayers() but it also removes all players from this GameMode instanc...</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00060">GameMode.cpp:60</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_aa627be5e60eeb2cf016a8aaa15025e30"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#aa627be5e60eeb2cf016a8aaa15025e30">proofps_dd::GameMode::removePlayer</a></div><div class="ttdeci">virtual bool removePlayer(const Player &amp;player)=0</div><div class="ttdoc">Removes data for the specified player.</div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_ae5e7dcb0571d7ec80ecb4b4a3e28f02f"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#ae5e7dcb0571d7ec80ecb4b4a3e28f02f">proofps_dd::GameMode::addPlayer</a></div><div class="ttdeci">virtual bool addPlayer(const Player &amp;player, pge_network::PgeINetwork &amp;network)=0</div><div class="ttdoc">Adds the specified player.</div></div>
<div class="ttc" id="aclassproofps__dd_1_1_game_mode_html_aeb6c97ef0b9c75bc598d8cc85f20e3b4"><div class="ttname"><a href="classproofps__dd_1_1_game_mode.html#aeb6c97ef0b9c75bc598d8cc85f20e3b4">proofps_dd::GameMode::getFragTable</a></div><div class="ttdeci">const std::list&lt; FragTableRow &gt; &amp; getFragTable() const</div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8cpp_source.html#l00095">GameMode.cpp:95</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_maps_html"><div class="ttname"><a href="classproofps__dd_1_1_maps.html">proofps_dd::Maps</a></div><div class="ttdef"><b>Definition</b> <a href="_maps_8h_source.html#l00027">Maps.h:28</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_networking_html"><div class="ttname"><a href="classproofps__dd_1_1_networking.html">proofps_dd::Networking</a></div><div class="ttdef"><b>Definition</b> <a href="_networking_8h_source.html#l00020">Networking.h:21</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_physics_html_a928e517801089c65b6816bd10376bffc"><div class="ttname"><a href="classproofps__dd_1_1_physics.html#a928e517801089c65b6816bd10376bffc">proofps_dd::Physics::colliding2_NoZ</a></div><div class="ttdeci">static bool colliding2_NoZ(float o1px, float o1py, float o1sx, float o1sy, float o2px, float o2py, float o2sx, float o2sy)</div><div class="ttdef"><b>Definition</b> <a href="_physics_8cpp_source.html#l00104">Physics.cpp:104</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a04a40f6863ce9bcb138bd45ea912e43a"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a04a40f6863ce9bcb138bd45ea912e43a">proofps_dd::PlayerHandling::resetSendClientUpdatesCounter</a></div><div class="ttdeci">void resetSendClientUpdatesCounter(proofps_dd::Config &amp;config)</div><div class="ttdef"><b>Definition</b> <a href="#l00643">PlayerHandling.cpp:643</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a117b8fc72f93fcdad2b1b0aa94cc72e1"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a117b8fc72f93fcdad2b1b0aa94cc72e1">proofps_dd::PlayerHandling::serverUpdateRespawnTimers</a></div><div class="ttdeci">void serverUpdateRespawnTimers(const proofps_dd::Config &amp;config, proofps_dd::GameMode &amp;gameMode, proofps_dd::Durations &amp;durations)</div><div class="ttdef"><b>Definition</b> <a href="#l00159">PlayerHandling.cpp:159</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a1184e42672d691213dc0e7f5b20be4ac"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a1184e42672d691213dc0e7f5b20be4ac">proofps_dd::PlayerHandling::handlePlayerEventFromServer</a></div><div class="ttdeci">bool handlePlayerEventFromServer(pge_network::PgeNetworkConnectionHandle connHandleServerSide, const proofps_dd::MsgPlayerEventFromServer &amp;msg)</div><div class="ttdef"><b>Definition</b> <a href="#l01018">PlayerHandling.cpp:1018</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a1811c440bfb236d166460ff9e2902b62"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a1811c440bfb236d166460ff9e2902b62">proofps_dd::PlayerHandling::serverSendUserUpdates</a></div><div class="ttdeci">void serverSendUserUpdates(PGEcfgProfiles &amp;cfgProfiles, proofps_dd::Config &amp;config, proofps_dd::Durations &amp;durations, proofps_dd::GameMode &amp;gameMode)</div><div class="ttdef"><b>Definition</b> <a href="#l00650">PlayerHandling.cpp:650</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a1b78d5fbd2b936ebb07972c2aa1ec4b2"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a1b78d5fbd2b936ebb07972c2aa1ec4b2">proofps_dd::PlayerHandling::handlePlayerDied</a></div><div class="ttdeci">void handlePlayerDied(Player &amp;player, XHair &amp;xhair, const pge_network::PgeNetworkConnectionHandle &amp;nKillerConnHandleServerSide, proofps_dd::GameMode &amp;gameMode)</div><div class="ttdef"><b>Definition</b> <a href="#l00058">PlayerHandling.cpp:58</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a3e8a5e2a0d3b79ae2019a91ff1653bae"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a3e8a5e2a0d3b79ae2019a91ff1653bae">proofps_dd::PlayerHandling::getConsole</a></div><div class="ttdeci">CConsole &amp; getConsole() const</div><div class="ttdef"><b>Definition</b> <a href="#l00049">PlayerHandling.cpp:49</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a52cdd8dbf8c7cfdb61898577de54045f"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a52cdd8dbf8c7cfdb61898577de54045f">proofps_dd::PlayerHandling::handleUserNameChange</a></div><div class="ttdeci">bool handleUserNameChange(pge_network::PgeNetworkConnectionHandle connHandleServerSide, const proofps_dd::MsgUserNameChangeAndBootupDone &amp;msg, proofps_dd::Config &amp;config, proofps_dd::GameMode &amp;gameMode, PGEcfgProfiles &amp;cfgProfiles)</div><div class="ttdef"><b>Definition</b> <a href="#l00437">PlayerHandling.cpp:437</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a559106dd5cfb384c608877135610648e"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a559106dd5cfb384c608877135610648e">proofps_dd::PlayerHandling::updatePlayersOldValues</a></div><div class="ttdeci">void updatePlayersOldValues()</div><div class="ttdef"><b>Definition</b> <a href="#l00192">PlayerHandling.cpp:192</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a61078cefb43a1a8b5483ec7427bb98f4"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a61078cefb43a1a8b5483ec7427bb98f4">proofps_dd::PlayerHandling::PlayerHandling</a></div><div class="ttdeci">PlayerHandling(PGE &amp;pge, proofps_dd::Durations &amp;durations, proofps_dd::GUI &amp;gui, std::map&lt; pge_network::PgeNetworkConnectionHandle, proofps_dd::Player &gt; &amp;mapPlayers, proofps_dd::Maps &amp;maps, proofps_dd::Sounds &amp;sounds)</div><div class="ttdef"><b>Definition</b> <a href="#l00025">PlayerHandling.cpp:25</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a63d1eb5d7ffb36b810891b101232fe30"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a63d1eb5d7ffb36b810891b101232fe30">proofps_dd::PlayerHandling::getLoggerModuleName</a></div><div class="ttdeci">static const char * getLoggerModuleName()</div><div class="ttdef"><b>Definition</b> <a href="#l00020">PlayerHandling.cpp:20</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a6d7317ea69b571a199e4bd58fb9b6630"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a6d7317ea69b571a199e4bd58fb9b6630">proofps_dd::PlayerHandling::updatePlayersVisuals</a></div><div class="ttdeci">void updatePlayersVisuals(const proofps_dd::Config &amp;config, proofps_dd::GameMode &amp;gameMode)</div><div class="ttdef"><b>Definition</b> <a href="#l01074">PlayerHandling.cpp:1074</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_a7c7c79f4e16ede0bcc2f52f059e8469b"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#a7c7c79f4e16ede0bcc2f52f059e8469b">proofps_dd::PlayerHandling::handleUserUpdateFromServer</a></div><div class="ttdeci">bool handleUserUpdateFromServer(pge_network::PgeNetworkConnectionHandle connHandleServerSide, const proofps_dd::MsgUserUpdateFromServer &amp;msg, XHair &amp;xhair, const proofps_dd::Config &amp;config, proofps_dd::GameMode &amp;gameMode)</div><div class="ttdef"><b>Definition</b> <a href="#l00770">PlayerHandling.cpp:770</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_aadf756677d23335aee5b0db20dec50d6"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#aadf756677d23335aee5b0db20dec50d6">proofps_dd::PlayerHandling::handleUserDisconnected</a></div><div class="ttdeci">bool handleUserDisconnected(pge_network::PgeNetworkConnectionHandle connHandleServerSide, const pge_network::MsgUserDisconnectedFromServer &amp;msg, proofps_dd::GameMode &amp;gameMode)</div><div class="ttdef"><b>Definition</b> <a href="#l00367">PlayerHandling.cpp:367</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_ab149831d1b98ec8c556b741e6af79d95"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#ab149831d1b98ec8c556b741e6af79d95">proofps_dd::PlayerHandling::writePlayerList</a></div><div class="ttdeci">void writePlayerList()</div><div class="ttdef"><b>Definition</b> <a href="#l00205">PlayerHandling.cpp:205</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_abf980bb9e4f7d43b143cb914a4147bbb"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#abf980bb9e4f7d43b143cb914a4147bbb">proofps_dd::PlayerHandling::handlePlayerRespawned</a></div><div class="ttdeci">void handlePlayerRespawned(Player &amp;player, XHair &amp;xhair)</div><div class="ttdef"><b>Definition</b> <a href="#l00116">PlayerHandling.cpp:116</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_aca7062c26e1d154976c33ea8a9a95747"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#aca7062c26e1d154976c33ea8a9a95747">proofps_dd::PlayerHandling::handleUserConnected</a></div><div class="ttdeci">bool handleUserConnected(pge_network::PgeNetworkConnectionHandle connHandleServerSide, const pge_network::MsgUserConnectedServerSelf &amp;msg, PGEcfgProfiles &amp;cfgProfiles, proofps_dd::Config &amp;config, proofps_dd::GameMode &amp;gameMode, std::function&lt; void(int)&gt; &amp;cbDisplayMapLoadingProgressUpdate)</div><div class="ttdef"><b>Definition</b> <a href="#l00216">PlayerHandling.cpp:216</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_ad6b307745116ba6177a917c4fffb55a7"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#ad6b307745116ba6177a917c4fffb55a7">proofps_dd::PlayerHandling::handleDeathNotificationFromServer</a></div><div class="ttdeci">bool handleDeathNotificationFromServer(pge_network::PgeNetworkConnectionHandle nDeadConnHandleServerSide, const proofps_dd::MsgDeathNotificationFromServer &amp;msg)</div><div class="ttdef"><b>Definition</b> <a href="#l00965">PlayerHandling.cpp:965</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_handling_html_aebc1556fba9dbe6179e6be50f97ac414"><div class="ttname"><a href="classproofps__dd_1_1_player_handling.html#aebc1556fba9dbe6179e6be50f97ac414">proofps_dd::PlayerHandling::serverRespawnPlayer</a></div><div class="ttdeci">void serverRespawnPlayer(Player &amp;player, bool restartGame, const proofps_dd::Config &amp;config)</div><div class="ttdef"><b>Definition</b> <a href="#l00145">PlayerHandling.cpp:145</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html"><div class="ttname"><a href="classproofps__dd_1_1_player.html">proofps_dd::Player</a></div><div class="ttdef"><b>Definition</b> <a href="_player_8h_source.html#l00040">Player.h:41</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_a05d0b095a4e638b558f134079f8d0139"><div class="ttname"><a href="classproofps__dd_1_1_player.html#a05d0b095a4e638b558f134079f8d0139">proofps_dd::Player::getServerSideConnectionHandle</a></div><div class="ttdeci">const pge_network::PgeNetworkConnectionHandle &amp; getServerSideConnectionHandle() const</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00296">Player.cpp:296</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_a1fa08e979998dc9b5b6de7da55826f74"><div class="ttname"><a href="classproofps__dd_1_1_player.html#a1fa08e979998dc9b5b6de7da55826f74">proofps_dd::Player::getObject3D</a></div><div class="ttdeci">PureObject3D * getObject3D() const</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00677">Player.cpp:677</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_a451ec29e2b00f6bc2fd0792619c0214a"><div class="ttname"><a href="classproofps__dd_1_1_player.html#a451ec29e2b00f6bc2fd0792619c0214a">proofps_dd::Player::getName</a></div><div class="ttdeci">const std::string &amp; getName() const</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00306">Player.cpp:306</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_a71d6c50e93d0fb54c4a95b184211daf2"><div class="ttname"><a href="classproofps__dd_1_1_player.html#a71d6c50e93d0fb54c4a95b184211daf2">proofps_dd::Player::getDeaths</a></div><div class="ttdeci">PgeOldNewValue&lt; int &gt; &amp; getDeaths()</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00567">Player.cpp:567</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_a9eeeb3bf1e5ea9aab700da3b2f68a663"><div class="ttname"><a href="classproofps__dd_1_1_player.html#a9eeeb3bf1e5ea9aab700da3b2f68a663">proofps_dd::Player::getRespawnFlag</a></div><div class="ttdeci">bool &amp; getRespawnFlag()</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00579">Player.cpp:579</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_ab6a8df62f5a73d6ce1c498284bb7c346"><div class="ttname"><a href="classproofps__dd_1_1_player.html#ab6a8df62f5a73d6ce1c498284bb7c346">proofps_dd::Player::getPos</a></div><div class="ttdeci">PgeOldNewValue&lt; PureVector &gt; &amp; getPos()</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00625">Player.cpp:625</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_abc1fc328295a2274fadc644e124789f6"><div class="ttname"><a href="classproofps__dd_1_1_player.html#abc1fc328295a2274fadc644e124789f6">proofps_dd::Player::getWeaponManager</a></div><div class="ttdeci">WeaponManager &amp; getWeaponManager()</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00399">Player.cpp:399</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_ac83a27d89879734a114ddf4d365bb759"><div class="ttname"><a href="classproofps__dd_1_1_player.html#ac83a27d89879734a114ddf4d365bb759">proofps_dd::Player::getFrags</a></div><div class="ttdeci">PgeOldNewValue&lt; int &gt; &amp; getFrags()</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l01292">Player.cpp:1292</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_acf1afe34c4363f54da41b4bbb4f16c43"><div class="ttname"><a href="classproofps__dd_1_1_player.html#acf1afe34c4363f54da41b4bbb4f16c43">proofps_dd::Player::respawn</a></div><div class="ttdeci">void respawn(bool bMe, const Weapon &amp;wpnDefaultAvailable, bool bServer)</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00584">Player.cpp:584</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_af13afd5bf5ec85d9789f910ca8918db7"><div class="ttname"><a href="classproofps__dd_1_1_player.html#af13afd5bf5ec85d9789f910ca8918db7">proofps_dd::Player::die</a></div><div class="ttdeci">void die(bool bMe, bool bServer)</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00530">Player.cpp:530</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_af70ea5846a878dc57459c73407f4df50"><div class="ttname"><a href="classproofps__dd_1_1_player.html#af70ea5846a878dc57459c73407f4df50">proofps_dd::Player::genUniqueUserName</a></div><div class="ttdeci">static void genUniqueUserName(char szNewUserName[proofps_dd::MsgUserNameChangeAndBootupDone::nUserNameBufferLength], const std::string &amp;sNameFromConfig, const std::map&lt; pge_network::PgeNetworkConnectionHandle, proofps_dd::Player &gt; &amp;m_mapPlayers)</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00030">Player.cpp:30</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_af8590e9659351943648a8e5ea8fe0248"><div class="ttname"><a href="classproofps__dd_1_1_player.html#af8590e9659351943648a8e5ea8fe0248">proofps_dd::Player::setInvulnerability</a></div><div class="ttdeci">void setInvulnerability(const bool &amp;bState, const unsigned int &amp;nSeconds=0)</div><div class="ttdoc">Both server and client use this function.</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00331">Player.cpp:331</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_player_html_afdfe1ededeb7da766a8d373213a9ebb1"><div class="ttname"><a href="classproofps__dd_1_1_player.html#afdfe1ededeb7da766a8d373213a9ebb1">proofps_dd::Player::setHealth</a></div><div class="ttdeci">void setHealth(int value)</div><div class="ttdef"><b>Definition</b> <a href="_player_8cpp_source.html#l00492">Player.cpp:492</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_sounds_html"><div class="ttname"><a href="classproofps__dd_1_1_sounds.html">proofps_dd::Sounds</a></div><div class="ttdef"><b>Definition</b> <a href="_sounds_8h_source.html#l00018">Sounds.h:19</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_x_hair_html"><div class="ttname"><a href="classproofps__dd_1_1_x_hair.html">proofps_dd::XHair</a></div><div class="ttdoc">Finally a dedicated class for crosshair was needed, because from PRooFPS-dd v0.2.5,...</div><div class="ttdef"><b>Definition</b> <a href="_x_hair_8h_source.html#l00025">XHair.h:26</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_x_hair_html_a016f10312d3d32b23ce96aab0a7d74d0"><div class="ttname"><a href="classproofps__dd_1_1_x_hair.html#a016f10312d3d32b23ce96aab0a7d74d0">proofps_dd::XHair::szCvarGuiXHairIdentifiesPlayers</a></div><div class="ttdeci">static constexpr char * szCvarGuiXHairIdentifiesPlayers</div><div class="ttdef"><b>Definition</b> <a href="_x_hair_8h_source.html#l00029">XHair.h:29</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_x_hair_html_a44c8df5eaddd905ea95f95ff6981e3b0"><div class="ttname"><a href="classproofps__dd_1_1_x_hair.html#a44c8df5eaddd905ea95f95ff6981e3b0">proofps_dd::XHair::handleMagLoaded</a></div><div class="ttdeci">void handleMagLoaded()</div><div class="ttdef"><b>Definition</b> <a href="_x_hair_8cpp_source.html#l00273">XHair.cpp:273</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_x_hair_html_a673471bd6f4e414db099b7666ec0f859"><div class="ttname"><a href="classproofps__dd_1_1_x_hair.html#a673471bd6f4e414db099b7666ec0f859">proofps_dd::XHair::hide</a></div><div class="ttdeci">void hide()</div><div class="ttdef"><b>Definition</b> <a href="_x_hair_8cpp_source.html#l00138">XHair.cpp:138</a></div></div>
<div class="ttc" id="aclassproofps__dd_1_1_x_hair_html_af4ab1b3dfb7a35376639f40f498612f4"><div class="ttname"><a href="classproofps__dd_1_1_x_hair.html#af4ab1b3dfb7a35376639f40f498612f4">proofps_dd::XHair::show</a></div><div class="ttdeci">void show()</div><div class="ttdef"><b>Definition</b> <a href="_x_hair_8cpp_source.html#l00111">XHair.cpp:111</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html"><div class="ttname"><a href="namespaceproofps__dd.html">proofps_dd</a></div><div class="ttdef"><b>Definition</b> <a href="_camera_handling_8h_source.html#l00023">CameraHandling.h:24</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html_a24042733b4a94a708bb71a5f9a9a254a"><div class="ttname"><a href="namespaceproofps__dd.html#a24042733b4a94a708bb71a5f9a9a254a">proofps_dd::MapItemType</a></div><div class="ttdeci">MapItemType</div><div class="ttdef"><b>Definition</b> <a href="_map_item_8h_source.html#l00021">MapItem.h:22</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html_a3696648f2af3a5c403ca5e588097ced0a9415785dfe55fa63c575ed88a9aef470"><div class="ttname"><a href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0a9415785dfe55fa63c575ed88a9aef470">proofps_dd::FallingFromHigh</a></div><div class="ttdeci">@ FallingFromHigh</div><div class="ttdef"><b>Definition</b> <a href="_player_8h_source.html#l00034">Player.h:34</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html_a3696648f2af3a5c403ca5e588097ced0acb1ff80e06f10421b852d35a0a8752c3"><div class="ttname"><a href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0acb1ff80e06f10421b852d35a0a8752c3">proofps_dd::ItemTake</a></div><div class="ttdeci">@ ItemTake</div><div class="ttdef"><b>Definition</b> <a href="_player_8h_source.html#l00036">Player.h:36</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html_a3696648f2af3a5c403ca5e588097ced0ad345e02203e21c17700641e2e42515d3"><div class="ttname"><a href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0ad345e02203e21c17700641e2e42515d3">proofps_dd::JumppadActivated</a></div><div class="ttdeci">@ JumppadActivated</div><div class="ttdef"><b>Definition</b> <a href="_player_8h_source.html#l00038">Player.h:37</a></div></div>
<div class="ttc" id="anamespaceproofps__dd_html_a3696648f2af3a5c403ca5e588097ced0af20f2c60887f554cfaabb224a1c1a906"><div class="ttname"><a href="namespaceproofps__dd.html#a3696648f2af3a5c403ca5e588097ced0af20f2c60887f554cfaabb224a1c1a906">proofps_dd::Landed</a></div><div class="ttdeci">@ Landed</div><div class="ttdef"><b>Definition</b> <a href="_player_8h_source.html#l00035">Player.h:35</a></div></div>
<div class="ttc" id="astdafx_8h_html"><div class="ttname"><a href="stdafx_8h.html">stdafx.h</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_durations_html"><div class="ttname"><a href="structproofps__dd_1_1_durations.html">proofps_dd::Durations</a></div><div class="ttdef"><b>Definition</b> <a href="_durations_8h_source.html#l00017">Durations.h:18</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_durations_html_a7e449a33670af51a3ead75182cc865f7"><div class="ttname"><a href="structproofps__dd_1_1_durations.html#a7e449a33670af51a3ead75182cc865f7">proofps_dd::Durations::m_nUpdateRespawnTimersDurationUSecs</a></div><div class="ttdeci">long long m_nUpdateRespawnTimersDurationUSecs</div><div class="ttdef"><b>Definition</b> <a href="_durations_8h_source.html#l00024">Durations.h:24</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_durations_html_ab8c861d7c1b35fec3fc3bf20ee61d5cb"><div class="ttname"><a href="structproofps__dd_1_1_durations.html#ab8c861d7c1b35fec3fc3bf20ee61d5cb">proofps_dd::Durations::m_nSendUserUpdatesDurationUSecs</a></div><div class="ttdeci">long long m_nSendUserUpdatesDurationUSecs</div><div class="ttdef"><b>Definition</b> <a href="_durations_8h_source.html#l00028">Durations.h:28</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_frag_table_row_html"><div class="ttname"><a href="structproofps__dd_1_1_frag_table_row.html">proofps_dd::FragTableRow</a></div><div class="ttdef"><b>Definition</b> <a href="_game_mode_8h_source.html#l00032">GameMode.h:33</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_death_notification_from_server_html"><div class="ttname"><a href="structproofps__dd_1_1_msg_death_notification_from_server.html">proofps_dd::MsgDeathNotificationFromServer</a></div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00944">PRooFPS-dd-packet.h:945</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_death_notification_from_server_html_a45c806f698b421471b9111053d161063"><div class="ttname"><a href="structproofps__dd_1_1_msg_death_notification_from_server.html#a45c806f698b421471b9111053d161063">proofps_dd::MsgDeathNotificationFromServer::m_nKillerConnHandleServerSide</a></div><div class="ttdeci">pge_network::PgeNetworkConnectionHandle m_nKillerConnHandleServerSide</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00972">PRooFPS-dd-packet.h:972</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_death_notification_from_server_html_aaafe595af6300812a7450634e23e9e11"><div class="ttname"><a href="structproofps__dd_1_1_msg_death_notification_from_server.html#aaafe595af6300812a7450634e23e9e11">proofps_dd::MsgDeathNotificationFromServer::initPkt</a></div><div class="ttdeci">static bool initPkt(pge_network::PgePacket &amp;pkt, const pge_network::PgeNetworkConnectionHandle &amp;nDeadConnHandleServerSide, const pge_network::PgeNetworkConnectionHandle &amp;nKillerConnHandleServerSide)</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00948">PRooFPS-dd-packet.h:948</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_player_event_from_server_html"><div class="ttname"><a href="structproofps__dd_1_1_msg_player_event_from_server.html">proofps_dd::MsgPlayerEventFromServer</a></div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00983">PRooFPS-dd-packet.h:984</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_player_event_from_server_html_a0ace14cba7a39ecedc51c656444e363f"><div class="ttname"><a href="structproofps__dd_1_1_msg_player_event_from_server.html#a0ace14cba7a39ecedc51c656444e363f">proofps_dd::MsgPlayerEventFromServer::m_optData1</a></div><div class="ttdeci">UOptionalData m_optData1</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l01057">PRooFPS-dd-packet.h:1057</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_player_event_from_server_html_aa0559ff7fed50338f2d4cf92ed7f69d4"><div class="ttname"><a href="structproofps__dd_1_1_msg_player_event_from_server.html#aa0559ff7fed50338f2d4cf92ed7f69d4">proofps_dd::MsgPlayerEventFromServer::m_optData3</a></div><div class="ttdeci">UOptionalData m_optData3</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l01059">PRooFPS-dd-packet.h:1059</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_player_event_from_server_html_aedda6566b3a5d3b305dd7b773addf8dc"><div class="ttname"><a href="structproofps__dd_1_1_msg_player_event_from_server.html#aedda6566b3a5d3b305dd7b773addf8dc">proofps_dd::MsgPlayerEventFromServer::m_iPlayerEventId</a></div><div class="ttdeci">pge_network::TByte m_iPlayerEventId</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l01054">PRooFPS-dd-packet.h:1054</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_player_event_from_server_html_aee88f64a842f84420ce488b858c06fb6"><div class="ttname"><a href="structproofps__dd_1_1_msg_player_event_from_server.html#aee88f64a842f84420ce488b858c06fb6">proofps_dd::MsgPlayerEventFromServer::m_optData2</a></div><div class="ttdeci">UOptionalData m_optData2</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l01058">PRooFPS-dd-packet.h:1058</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_server_info_from_server_html_a804ef6389636b58d32c17b6223d84cad"><div class="ttname"><a href="structproofps__dd_1_1_msg_server_info_from_server.html#a804ef6389636b58d32c17b6223d84cad">proofps_dd::MsgServerInfoFromServer::initPkt</a></div><div class="ttdeci">static bool initPkt(pge_network::PgePacket &amp;pkt, const unsigned int &amp;nMaxFps, const unsigned int &amp;nTickrate, const unsigned int &amp;nPhysicsRateMin, const unsigned int &amp;nClientUpdateRate, const GameModeType &amp;iGameModeType, const unsigned int &amp;nFragLimit, const unsigned int &amp;nTimeLimitSecs, const unsigned int &amp;nTimeRemainingMillisecs, const int &amp;nFallDamageMultiplier, const unsigned int &amp;nRespawnTimeSecs, const unsigned int &amp;nRespawnInvulnerabilityTimeSecs)</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00084">PRooFPS-dd-packet.h:84</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_name_change_and_bootup_done_html"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html">proofps_dd::MsgUserNameChangeAndBootupDone</a></div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00424">PRooFPS-dd-packet.h:425</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_name_change_and_bootup_done_html_a29159d5fc184a4e812f0cae39ae414ba"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a29159d5fc184a4e812f0cae39ae414ba">proofps_dd::MsgUserNameChangeAndBootupDone::m_szUserName</a></div><div class="ttdeci">char m_szUserName[nUserNameBufferLength]</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00456">PRooFPS-dd-packet.h:456</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_name_change_and_bootup_done_html_a4648eda0f05a4ad4cca034273e7cfad4"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a4648eda0f05a4ad4cca034273e7cfad4">proofps_dd::MsgUserNameChangeAndBootupDone::m_bCurrentClient</a></div><div class="ttdeci">bool m_bCurrentClient</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00455">PRooFPS-dd-packet.h:455</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_name_change_and_bootup_done_html_a9ac9fc17a117b47ac0c5ad2018c0f3f3"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_name_change_and_bootup_done.html#a9ac9fc17a117b47ac0c5ad2018c0f3f3">proofps_dd::MsgUserNameChangeAndBootupDone::initPkt</a></div><div class="ttdeci">static bool initPkt(pge_network::PgePacket &amp;pkt, const pge_network::PgeNetworkConnectionHandle &amp;connHandleServerSide, bool bCurrentClient, const std::string &amp;sUserName)</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00429">PRooFPS-dd-packet.h:429</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_setup_from_server_html"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_setup_from_server.html">proofps_dd::MsgUserSetupFromServer</a></div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00376">PRooFPS-dd-packet.h:377</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_setup_from_server_html_a221e17b18c7c2699811ef383a1997a0e"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_setup_from_server.html#a221e17b18c7c2699811ef383a1997a0e">proofps_dd::MsgUserSetupFromServer::m_bCurrentClient</a></div><div class="ttdeci">bool m_bCurrentClient</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00408">PRooFPS-dd-packet.h:408</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_setup_from_server_html_ad2216b7cd53059ed5be0fafb2e2e1322"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_setup_from_server.html#ad2216b7cd53059ed5be0fafb2e2e1322">proofps_dd::MsgUserSetupFromServer::initPkt</a></div><div class="ttdeci">static bool initPkt(pge_network::PgePacket &amp;pkt, const pge_network::PgeNetworkConnectionHandle &amp;connHandleServerSide, bool bCurrentClient, const std::string &amp;sIpAddress, const std::string &amp;sMapFilename)</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00380">PRooFPS-dd-packet.h:380</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html">proofps_dd::MsgUserUpdateFromServer</a></div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00597">PRooFPS-dd-packet.h:598</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a0b18bf711ca01b4b5fb63e459bcefb48"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a0b18bf711ca01b4b5fb63e459bcefb48">proofps_dd::MsgUserUpdateFromServer::m_bRespawn</a></div><div class="ttdeci">bool m_bRespawn</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00667">PRooFPS-dd-packet.h:667</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a13064d4585969e06a74a7c49ad54f2a5"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a13064d4585969e06a74a7c49ad54f2a5">proofps_dd::MsgUserUpdateFromServer::m_nHealth</a></div><div class="ttdeci">int m_nHealth</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00666">PRooFPS-dd-packet.h:666</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a2e1cb30d6f1de1f77d0a2d58cac4f45d"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a2e1cb30d6f1de1f77d0a2d58cac4f45d">proofps_dd::MsgUserUpdateFromServer::m_fWpnMomentaryAccuracy</a></div><div class="ttdeci">float m_fWpnMomentaryAccuracy</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00662">PRooFPS-dd-packet.h:662</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a3c2bfeb5875a25d325c1b6b5634f1cfb"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a3c2bfeb5875a25d325c1b6b5634f1cfb">proofps_dd::MsgUserUpdateFromServer::m_bCrouch</a></div><div class="ttdeci">bool m_bCrouch</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00663">PRooFPS-dd-packet.h:663</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a4768390cbc2b13324833dd2e8367b479"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a4768390cbc2b13324833dd2e8367b479">proofps_dd::MsgUserUpdateFromServer::m_nArmor</a></div><div class="ttdeci">int m_nArmor</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00665">PRooFPS-dd-packet.h:665</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a48e144412ea58a1c233756ec96eceec8"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a48e144412ea58a1c233756ec96eceec8">proofps_dd::MsgUserUpdateFromServer::m_nDeaths</a></div><div class="ttdeci">int m_nDeaths</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00669">PRooFPS-dd-packet.h:669</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a5025f12fb19bf07c0785da834f3f68e7"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a5025f12fb19bf07c0785da834f3f68e7">proofps_dd::MsgUserUpdateFromServer::m_fPlayerAngleZ</a></div><div class="ttdeci">TPureFloat m_fPlayerAngleZ</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00660">PRooFPS-dd-packet.h:660</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a50bd6aa4405a8596b51f80a09de7e420"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a50bd6aa4405a8596b51f80a09de7e420">proofps_dd::MsgUserUpdateFromServer::m_nFrags</a></div><div class="ttdeci">int m_nFrags</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00668">PRooFPS-dd-packet.h:668</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a6fef448775b585aec29e90ae93806212"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a6fef448775b585aec29e90ae93806212">proofps_dd::MsgUserUpdateFromServer::m_bInvulnerability</a></div><div class="ttdeci">bool m_bInvulnerability</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00670">PRooFPS-dd-packet.h:670</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_a78d3e482756d74f00bdf77d3d25788b1"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#a78d3e482756d74f00bdf77d3d25788b1">proofps_dd::MsgUserUpdateFromServer::m_fWpnAngleZ</a></div><div class="ttdeci">TPureFloat m_fWpnAngleZ</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00661">PRooFPS-dd-packet.h:661</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_aa6ee6516128b803afe41cd4f299566c0"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#aa6ee6516128b803afe41cd4f299566c0">proofps_dd::MsgUserUpdateFromServer::m_fPlayerAngleY</a></div><div class="ttdeci">TPureFloat m_fPlayerAngleY</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00659">PRooFPS-dd-packet.h:659</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_aaf4bf5e4a99ea8728f9a68d48c38a7f9"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#aaf4bf5e4a99ea8728f9a68d48c38a7f9">proofps_dd::MsgUserUpdateFromServer::m_fSomersaultAngle</a></div><div class="ttdeci">float m_fSomersaultAngle</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00664">PRooFPS-dd-packet.h:664</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_acbe81e62703dda0f94c50bed297db9ad"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#acbe81e62703dda0f94c50bed297db9ad">proofps_dd::MsgUserUpdateFromServer::m_pos</a></div><div class="ttdeci">TXYZ m_pos</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00658">PRooFPS-dd-packet.h:658</a></div></div>
<div class="ttc" id="astructproofps__dd_1_1_msg_user_update_from_server_html_afca442c02e1d376443c47c34bbb3667f"><div class="ttname"><a href="structproofps__dd_1_1_msg_user_update_from_server.html#afca442c02e1d376443c47c34bbb3667f">proofps_dd::MsgUserUpdateFromServer::initPkt</a></div><div class="ttdeci">static bool initPkt(pge_network::PgePacket &amp;pkt, const pge_network::PgeNetworkConnectionHandle &amp;connHandleServerSide, const TPureFloat x, const TPureFloat y, const TPureFloat z, TPureFloat fPlayerAngleY, TPureFloat fPlayerAngleZ, TPureFloat fWpnAngleZ, float fWpnMomentaryAccuracy, bool bCrouch, float fSomersaultAngle, int nArmor, int nHealth, bool bRespawn, int nFrags, int nDeaths, bool bInvulnerability)</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00601">PRooFPS-dd-packet.h:601</a></div></div>
<div class="ttc" id="aunionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data_html_a292a07e14d4f87b26afbfe96280d8fac"><div class="ttname"><a href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a292a07e14d4f87b26afbfe96280d8fac">proofps_dd::MsgPlayerEventFromServer::UOptionalData::m_nValue</a></div><div class="ttdeci">int m_nValue</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00995">PRooFPS-dd-packet.h:995</a></div></div>
<div class="ttc" id="aunionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data_html_a9fa2973260c721da1b12ced0c1731044"><div class="ttname"><a href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#a9fa2973260c721da1b12ced0c1731044">proofps_dd::MsgPlayerEventFromServer::UOptionalData::m_bValue</a></div><div class="ttdeci">bool m_bValue</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00994">PRooFPS-dd-packet.h:994</a></div></div>
<div class="ttc" id="aunionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data_html_acd17d377f6f20f4481073749f140d741"><div class="ttname"><a href="unionproofps__dd_1_1_msg_player_event_from_server_1_1_u_optional_data.html#acd17d377f6f20f4481073749f140d741">proofps_dd::MsgPlayerEventFromServer::UOptionalData::m_fValue</a></div><div class="ttdeci">float m_fValue</div><div class="ttdef"><b>Definition</b> <a href="_p_roo_f_p_s-dd-packet_8h_source.html#l00996">PRooFPS-dd-packet.h:996</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d0bdb61673d5989b6e521bc4f541470e.html">PRooFPS-dd</a></li><li class="navelem"><a class="el" href="_player_handling_8cpp.html">PlayerHandling.cpp</a></li>
    <li class="footer">Generated on Mon Sep 23 2024 00:28:05 for PRooFPS-dd Dev Doc by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
