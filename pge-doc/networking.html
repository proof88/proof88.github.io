<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PGE API: Networking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="pure_doxystyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PGE API<span id="projectnumber">&#160;0.4</span>
   </div>
   <div id="projectbrief">PR00F&#39;s Game Engine full documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('networking.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Networking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#networking_intro">Intro</a>
  </li>
  <li class="level1">
    <a href="#networking_libs">Networking Libraries</a>
  </li>
  <li class="level1">
    <a href="#client_server">Client-Server Model</a>
  </li>
  <li class="level1">
    <a href="#pge_network_access">Access to Networking Functionality</a>
  </li>
  <li class="level1">
    <a href="#pge_network_packets">Packets and Messages</a>
  </li>
  <li class="level1">
    <a href="#pge_network_allowlisting">Allowlisting</a>
  </li>
  <li class="level1">
    <a href="#networking_pages">Networking Reading Materials</a>
    <ul>
      <li class="level2">
        <a href="#low_level_networking_pages">Low-level Networking Topics</a>
      </li>
      <li class="level2">
        <a href="#high_level_networking_pages">High-level Networking Topics</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="networking_intro"></a>
Intro</h1>
<p>When it was time to add multiplayer support to my game engine, I browsed the internet for already existing solutions I could integrate, because the networking topic itself on its own contains lots of challenges. <br  />
 I didn't want to reinvent the wheel, for me it was enough to read about the problems and possible solutions in this area, and to use an existing solution instead of implementing my own. <br  />
 Establishing communication between computers behind NAT devices, handling different endianness of computers, or lag compensation are just a few examples of the challenges in this area.</p>
<h1><a class="anchor" id="networking_libs"></a>
Networking Libraries</h1>
<p>For lists of networking libraries, check these pages:</p>
<ul>
<li><a href="https://www.reddit.com/r/gamedev/comments/93kr9h/recommended_c_udp_networking_library/">https://www.reddit.com/r/gamedev/comments/93kr9h/recommended_c_udp_networking_library/</a></li>
<li><a href="https://github.com/MFatihMAR/Game-Networking-Resources">https://github.com/MFatihMAR/Game-Networking-Resources</a></li>
</ul>
<p>During my research, I checked the following 3 popular libraries from a closer perspective:</p><ul>
<li><b>yojimbo</b>: <a href="https://github.com/networkprotocol/yojimbo">https://github.com/networkprotocol/yojimbo</a><ul>
<li><a href="https://github.com/networkprotocol/yojimbo/issues/25">https://github.com/networkprotocol/yojimbo/issues/25</a></li>
<li><a href="https://www.gamedev.net/forums/topic/697635-is-anyone-using-yojimbo-for-networking/">https://www.gamedev.net/forums/topic/697635-is-anyone-using-yojimbo-for-networking/</a></li>
</ul>
</li>
<li><b>GNS (GameNetworkingSockets)</b>: <a href="https://github.com/ValveSoftware/GameNetworkingSockets">https://github.com/ValveSoftware/GameNetworkingSockets</a></li>
<li><b>SLN (SLikeNet)</b>: <a href="https://github.com/SLikeSoft/SLikeNet">https://github.com/SLikeSoft/SLikeNet</a></li>
</ul>
<p>All 3 libs offer features like <b>message encryption between players, packet fragmentation and reassembly, cross-platform support, traffic statistics</b>. <br  />
 So I don't need to implement any such low-level features, I can more concentrate on higher-level network-related features.</p>
<p>Unfortunately, <b>yojimbo</b> doesn't have <b>NAT punch-through</b> support, for which I decided not to use it, because I don't want to implement / or use additional library for this purpose. <br  />
 Both <b>GNS</b> and <b>SLN</b> offer sophisticated connection establish between computers that are NOT connected directly to the internet, this is not in <b>yojimbo</b>. <br  />
</p>
<p>Although the codebase of <b>SLN</b> hasn't changed since 2019, it has a solid base: it is a fork of <b>RakNet</b> which was developed for more than a decade, and it was also used by Unity engine (maybe it is still used under the hood). <br  />
 In theory, <b>SLN</b> fixes some IPv6-related bugs of <b>RakNet</b> but I don't know if it has become really bug-free. <br  />
</p>
<p>Comparing <b>GNS</b> and <b>SLN</b> today is more difficult than it used to be in ~2019 because since then <b>GNS</b> added some missing features already available in <b>SLN</b>. <br  />
 Both libs provide:</p><ul>
<li>experience by others used in actual games;</li>
<li>not only client-server model but also P2P;</li>
<li>IPv6 support.</li>
</ul>
<p><b>SLN</b> offers support for game object serialization and data compression, I don't see much support for these in <b>GNS</b> as of June 2022 with version 1.4.0. <br  />
 It also has some other fancy stuff like game lobby, autopatcher, etc. <br  />
 It also has much less dependencies and easier to build.</p>
<p><b>GNS</b> on the other hand, is still actively maintained by Valve, used by Dota and CSGO. <br  />
 Because of this, I opted for <b>GNS</b>. <br  />
 Here is a <b>small game project</b> utilizing <b>GNS</b>: <a href="https://github.com/David-Elle-Jack-Oisin/TeamProject/tree/main/src/network">https://github.com/David-Elle-Jack-Oisin/TeamProject/tree/main/src/network</a></p>
<h1><a class="anchor" id="client_server"></a>
Client-Server Model</h1>
<p>I'm implementing the <b>client-server</b> networking model in the engine because it sounds suitable for my future projects and hopefully easier to implement than P2P. <br  />
 In this model, there is always exactly 1 machine with server role, and some clients connected to the server. <br  />
 There is no communication between clients, server keeps all clients updated about game state.</p>
<h1><a class="anchor" id="pge_network_access"></a>
Access to Networking Functionality</h1>
<p>PGE provides networking functionality through the PgeNetwork class instance in <a class="el" href="namespacepge__network.html" title="These packet and message structs are sent between server and clients.">pge_network</a> namespace, that can be accessed by PGE::getNetwork() function. <br  />
 This PgeNetwork instance must be initialized before networking functionality can be used, however PGE initializes it automatically upon startup. <br  />
 It will be either a client or server instance based on the value of CVAR_NET_SERVER. <br  />
 Common functions can be accessed through PgeNetwork::getServerClientInstance(), more specifics are accessed through either PgeNetwork::getClient() or PgeNetwork::getServer() functions.</p>
<p>TODO: ask doxygen to insert value of CVAR_NET_SERVER above!</p>
<p>TODO: make a separate page explaining CVARs!</p>
<h1><a class="anchor" id="pge_network_packets"></a>
Packets and Messages</h1>
<p>Server and client instances communicate by sending and receiving PgePacket structs that encapsulate single messages. <br  />
 As of PGE v0.4 there can be only 1 message within a PgePacket, and there is only 3 different kind of messages:</p><ul>
<li>MsgUserConnected;</li>
<li>MsgUserDisconnected;</li>
<li>MsgApp.</li>
</ul>
<p>An application can define its custom messages, all those will be MsgApp kind.</p>
<p>TODO: make link to tag PGE v0.4 above!</p>
<p>TODO: should we use <a class="el" href="namespacepge__network.html" title="These packet and message structs are sent between server and clients.">pge_network</a> namespace everywhere explicitly?</p>
<h1><a class="anchor" id="pge_network_allowlisting"></a>
Allowlisting</h1>
<p>In order to be able to receive messages over the network, the messages need to be explicitly allowlisted, otherwise they are ignored. <br  />
 By default server instance is allowed to receive MsgApp messages only, client instance is allowed to receive MsgUserDisconnected and MsgApp messages. <br  />
 Server also processes MsgUserConnected and MsgUserDisconnected, however it just self-injects these, that is why it is NOT allowed to receive these over network. <br  />
</p>
<p>It is very important to understand that even though MsgApp is allowed for both client and server, <b>by default any kind of custom message inside MsgApp will be ignored</b>. <br  />
 <b>Application MUST explicitly allowlist its custom messages separately for both client and server.</b> <br  />
 This can be done by adding the allowed custom messages to the container accessed by PgeNetwork::getServerClientInstance().getAllowListedAppMessages().</p>
<h1><a class="anchor" id="networking_pages"></a>
Networking Reading Materials</h1>
<h2><a class="anchor" id="low_level_networking_pages"></a>
Low-level Networking Topics</h2>
<p>The Low-level networking topics for me are usually those topics which I found very fundamental to understand and use BUT I don't want to implement. <br  />
 For example, packet fragmentation and reassembly: it is good to know why it is needed and I want to have it by using the already existing implementation in the chosen library instead of implementing it by myself.</p>
<p>Packet Basics:</p><ul>
<li><a href="https://gafferongames.com/post/reading_and_writing_packets/">https://gafferongames.com/post/reading_and_writing_packets/</a></li>
<li><a href="https://gafferongames.com/post/serialization_strategies/">https://gafferongames.com/post/serialization_strategies/</a></li>
</ul>
<p>Floating Point Determinism:</p><ul>
<li><a href="https://gafferongames.com/post/floating_point_determinism/">https://gafferongames.com/post/floating_point_determinism/</a></li>
</ul>
<p>NAT Punch-through:</p><ul>
<li><a href="https://stackoverflow.com/questions/43181893/nat-punchthrough-understanding-p2p-concept">https://stackoverflow.com/questions/43181893/nat-punchthrough-understanding-p2p-concept</a></li>
<li><a href="https://keithjohnston.wordpress.com/2014/02/17/nat-punch-through-for-multiplayer-games/">https://keithjohnston.wordpress.com/2014/02/17/nat-punch-through-for-multiplayer-games/</a></li>
<li><a href="http://www.raknet.net/raknet/manual/natpunchthrough.html">http://www.raknet.net/raknet/manual/natpunchthrough.html</a></li>
<li><a href="https://bford.info/pub/net/p2pnat/">https://bford.info/pub/net/p2pnat/</a></li>
</ul>
<p>Importance of backend services:</p><ul>
<li><a href="https://www.gamedeveloper.com/programming/half-life-and-team-fortress-networking-closing-the-loop-on-scalable-network-gaming-backend-services">https://www.gamedeveloper.com/programming/half-life-and-team-fortress-networking-closing-the-loop-on-scalable-network-gaming-backend-services</a></li>
</ul>
<p>Security Issues of Online Gaming:</p><ul>
<li><a href="https://www.gamedev.net/reference/articles/article2062.asp">https://www.gamedev.net/reference/articles/article2062.asp</a></li>
<li><a href="https://www.gamedeveloper.com/disciplines/security-in-online-games">https://www.gamedeveloper.com/disciplines/security-in-online-games</a></li>
</ul>
<h2><a class="anchor" id="high_level_networking_pages"></a>
High-level Networking Topics</h2>
<p>The High-level networking topics for me are usually those topics which I also want/have to implement in my software. <br  />
 For example, scheduling of sending packets, tick rate, etc.</p>
<p>Client-server vs P2P model:</p><ul>
<li><a href="https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/">https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/</a></li>
<li><a href="https://docs.unrealengine.com/4.27/en-US/InteractiveExperiences/Networking/Overview/">https://docs.unrealengine.com/4.27/en-US/InteractiveExperiences/Networking/Overview/</a></li>
<li><a href="https://gamedev.stackexchange.com/questions/67738/limitations-of-p2p-multiplayer-games-vs-client-server">https://gamedev.stackexchange.com/questions/67738/limitations-of-p2p-multiplayer-games-vs-client-server</a></li>
</ul>
<p>Client-side prediction, interpolation, latency mitigation, etc:</p><ul>
<li><a href="https://www.gabrielgambetta.com/client-server-game-architecture.html">https://www.gabrielgambetta.com/client-server-game-architecture.html</a></li>
<li><a href="https://isetta.io/blogs/week-9/">https://isetta.io/blogs/week-9/</a></li>
<li><a href="https://learn.colyseus.io/phaser/2-linear-interpolation.html">https://learn.colyseus.io/phaser/2-linear-interpolation.html</a></li>
<li><a href="https://www.gabrielgambetta.com/client-side-prediction-server-reconciliation.html">https://www.gabrielgambetta.com/client-side-prediction-server-reconciliation.html</a></li>
<li><a href="https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/">https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/</a></li>
<li><a href="https://www.codersblock.org/blog/multiplayer-fps-part-8">https://www.codersblock.org/blog/multiplayer-fps-part-8</a></li>
<li><a href="https://learn.colyseus.io/phaser/1-basic-player-movement.html">https://learn.colyseus.io/phaser/1-basic-player-movement.html</a></li>
<li><a href="https://forum.unity.com/threads/tips-for-server-authoritative-player-movement.199538/">https://forum.unity.com/threads/tips-for-server-authoritative-player-movement.199538/</a></li>
<li><a href="https://gamedev.stackexchange.com/questions/184334/how-does-a-server-receive-every-player-input-with-a-server-authoritative-structu">https://gamedev.stackexchange.com/questions/184334/how-does-a-server-receive-every-player-input-with-a-server-authoritative-structu</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking">https://developer.valvesoftware.com/wiki/Source_Multiplayer_Networking</a></li>
<li>CS 1.6 Rates: <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=126383209">https://steamcommunity.com/sharedfiles/filedetails/?id=126383209</a></li>
<li><a href="https://developer.valvesoftware.com/wiki/Latency_Compensating_Methods_in_Client/Server_In-game_Protocol_Design_and_Optimization">https://developer.valvesoftware.com/wiki/Latency_Compensating_Methods_in_Client/Server_In-game_Protocol_Design_and_Optimization</a></li>
<li><a href="https://docs.unrealengine.com/udk/Three/NetworkingOverview.html">https://docs.unrealengine.com/udk/Three/NetworkingOverview.html</a></li>
<li><a href="https://docs.unrealengine.com/udk/Three/NetworkingOverview.html#Player%20Movement%20and%20Prediction">https://docs.unrealengine.com/udk/Three/NetworkingOverview.html#Player%20Movement%20and%20Prediction</a></li>
<li><a href="http://www.cs.uu.nl/docs/vakken/magr/portfolio/HA2/lecture3.pdf">http://www.cs.uu.nl/docs/vakken/magr/portfolio/HA2/lecture3.pdf</a></li>
<li><a href="http://blog.wolfire.com/2011/03/GDC-Session-Summary-Halo-networking">http://blog.wolfire.com/2011/03/GDC-Session-Summary-Halo-networking</a></li>
</ul>
<p>Misc:</p><ul>
<li><a href="https://pvigier.github.io/2019/09/08/beginner-guide-game-networking.html">https://pvigier.github.io/2019/09/08/beginner-guide-game-networking.html</a></li>
<li><a href="file:///D:/_DOKSIK_/J%C3%A1t%C3%A9kfejleszt%C3%A9s/networking/faq.htm">file:///D:/_DOKSIK_/J%C3%A1t%C3%A9kfejleszt%C3%A9s/networking/faq.htm</a></li>
<li><a href="https://www.gamedeveloper.com/programming/multiplayer-math">https://www.gamedeveloper.com/programming/multiplayer-math</a></li>
<li><a href="file:///D:/_DOKSIK_/J%C3%A1t%C3%A9kfejleszt%C3%A9s/networking/TheQuake3NetworkingModel.html">file:///D:/_DOKSIK_/J%C3%A1t%C3%A9kfejleszt%C3%A9s/networking/TheQuake3NetworkingModel.html</a></li>
<li><a href="https://derekzeng.me/articles/zt-bookofhook-the-quake3-networking-model">https://derekzeng.me/articles/zt-bookofhook-the-quake3-networking-model</a></li>
<li><a href="https://gamedev.net/forums/topic/291287-the-quake3-networking-model-question/2841358/">https://gamedev.net/forums/topic/291287-the-quake3-networking-model-question/2841358/</a></li>
<li><a href="https://www.jfedor.org/quake3/">https://www.jfedor.org/quake3/</a></li>
<li><a href="https://gamasutra.com/view/news/35929/Opinion_Synchronous_RTS_Engines_And_A_Tale_of_Desy">https://gamasutra.com/view/news/35929/Opinion_Synchronous_RTS_Engines_And_A_Tale_of_Desy</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
